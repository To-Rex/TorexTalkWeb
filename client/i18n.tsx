import React, { createContext, useContext, useEffect, useMemo, useState } from "react";

export type Locale = "uz" | "en" | "ru";

const messages: Record<Locale, Record<string, string>> = {
  uz: {
    app_name: "Torex-Talk",
    tagline: "Telegram boshqaruvi va AI-avtojavob platformasi",
    get_started: "Boshlash",
    sign_in: "Kirish",
    dashboard: "Boshqaruv paneli",
    admin_panel: "Admin panel",
    features: "Xususiyatlar",
    pricing: "Tariflar",
    language: "Til",
    hero_title: "Telegram hisoblaringizni boshqaring, xabarlarni avtomatlashtiring",
    hero_sub: "Mass xabar yuborish, AI asosida avtojavob, rejalashtirish va tahlillar — barchasi bitta minimalistik ilovada.",
    cta_primary: "Ro'yxatdan o'tish",
    cta_secondary: "Tizimga kirish",
    learn_more: "Batafsil",
    quick_features: "Asosiy xususiyatlar",
    feature_1_t: "Telegramga o'xshash chat interfeysi",
    feature_1_d: "Shaxsiy va guruh chatlar alohida, tezkor va qulay boshqaruv.",
    feature_2_t: "Mass xabar yuborish",
    feature_2_d: "Barcha shaxsiy chatlarga bir xil xabarni bir zumda jo'nating.",
    feature_3_t: "AI-avtojavob",
    feature_3_d: "Cheksiz Q&A yordamida o'zingizning AI modelangizni o'rgating.",
    feature_4_t: "Rejalashtirish va shablonlar",
    feature_4_d: "Xabarlarni keyinga qo'ying va matn shablonlarini saqlang.",
    feature_5_t: "Onlayn bildirishnomalar",
    feature_5_d: "Yangi xabarlar va avtojavob holatlari haqida darhol xabardor bo'ling.",
    feature_6_t: "Statistika va tahlillar",
    feature_6_d: "Yuborilgan xabarlar va faollik bo'yicha umumiy ko'rsatkichlar.",
    features_sub: "Platformaning asosiy imkoniyatlari va ulardan foydalanish ssenariylari",
    feature_1_b1: "Shaxsiy va guruh chatlar ajratilgan",
    feature_1_b2: "Tezkor qidiruv va filtrlash",
    feature_1_b3: "Yuqori ustun suhbatlar (pinned)",
    feature_2_b1: "Jadval bo'yicha yuborish",
    feature_2_b2: "Segmentatsiya va filtrlash",
    feature_2_b3: "Rate limiting bilan xavfsiz jo'natish",
    feature_3_b1: "Savol-javob juftliklari bilan o'rgatish",
    feature_3_b2: "Ishonchlilik chegarasi va fallback",
    feature_3_b3: "Shablonli avtomatik javoblar",
    feature_4_b1: "Vaqt zonalarini hisobga olish",
    feature_4_b2: "Takroriy rejalashtirish",
    feature_4_b3: "O'zgaruvchilar bilan shablonlar",
    feature_5_b1: "Web push va email bildirishnomalar",
    feature_5_b2: "Kanal bo'yicha filtrlash",
    feature_5_b3: "Real vaqt rejimida",
    feature_6_b1: "Ochilish va javob ko'rsatkichlari",
    feature_6_b2: "O'rtacha javob vaqti",
    feature_6_b3: "CSV/PDF eksporti",
    plans_title: "Obuna rejalar",
    plan_free: "Bepul / Basic",
    plan_plus: "Plus",
    plan_premium: "Premium",
    plan_free_benefit: "3 tagacha Telegram akkaunt",
    plan_plus_benefit: "10 tagacha Telegram akkaunt",
    plan_premium_benefit: "Cheksiz akkauntlar + kengaytirilgan AI",
    choose_plan: "Rejani tanlash",
    billing_monthly: "Oyiga",
    billing_yearly: "Yiliga",
    yearly_saving: "2 oy bepul",
    includes: "Nimalar kiradi",
    all_plans_include: "Barcha tariflarda mavjud",
    popular: "Ommabop",
    compare_title: "Xususiyatlar taqqoslanishi",
    guarantee_title: "14 kunlik pulni qaytarish kafolati",
    guarantee_desc: "Agar platforma siz kutgan natijani bermasa, 14 kun ichida to'liq qaytarib beramiz.",
    contact_cta: "Savollaringiz bormi? Biz bilan bog'laning",
    selected: "Tanlandi",
    label_seats: "Jamoa a'zolari",
    label_msgs: "Oylik xabar limiti",
    label_support: "Qo'llab-quvvatlash",
    label_api: "API kirish",
    label_integrations: "Integratsiyalar",
    label_audit: "Audit jurnallari",
    support_none: "Yo'q",
    support_business: "Ish vaqti",
    support_247: "24/7",
    payment_methods: "To'lov usullari",
    payment_list: "Visa, Mastercard, Payme, Click",
    faq_title: "Ko'p so'raladigan savollar",
    faq_q1: "Qanday to'lov usullari mavjud?",
    faq_a1: "Visa/Mastercard, mahalliy to'lov tizimlari (Payme/Click) va invois orqali to'lash mumkin.",
    faq_q2: "Obunani istalgan payt bekor qila olamanmi?",
    faq_a2: "Ha, istalgan vaqtda bekor qilishingiz mumkin. Keyingi davr uchun to'lov olinmaydi.",
    faq_q3: "Hisoblar cheklovi qanday?",
    faq_a3: "Basic: 3 ta, Plus: 10 ta, Premium: cheksiz akkauntlar qo'llab-quvvatlanadi.",
    footer_rights: "Barcha huquqlar himoyalangan",
    footer_telegram_manager: "Telegram manager",
    footer_description: "Xabarlarni avtomatlashtirish, mass xabar va AI-avtojavoblar uchun qulay platforma.",
    footer_documents: "Hujjatlar",
    footer_terms: "Oferta (Foydalanuvchi kelishuvi)",
    footer_privacy: "Maxfiylik siyosati",
    footer_security: "Ma'lumotlar xavfsizligi",
    footer_support: "Qo'llab-quvvatlash",
    footer_help: "Yordam",
    footer_partners: "Hamkorlik",
    footer_contact: "Aloqa",
    footer_developer: "Ishlab chiqaruvchi:",
    how_it_works: "Qanday ishlaydi",
    feature_mass_messaging_title: "Mass xabar yuborish",
    feature_mass_messaging_desc: "Yagona panel orqali yuzlab foydalanuvchilarga bir vaqtning oʻzida xabar yuboring va yuborish jadvalini sozlang.",
    feature_ai_replies_title: "AI avtojavoblar",
    feature_ai_replies_desc: "Savollarga avtomatik javoblar va shablonlar yaratish, bir savolga bir nechta javob variantlari bilan.",
    feature_analytics_title: "Tahlillar va statistikalar",
    feature_analytics_desc: "Kampaniya samaradorligini kuzatib boring, ochilish va javob ko'rsatkichlarini oling.",
    step1_title: "Hisobni ulang",
    step1_desc: "Google yoki email orqali ro'yxatdan o'ting va Telegram hisobingizni ulang.",
    step2_title: "Avtomatlashtiring",
    step2_desc: "Auto-replies, shablonlar va mass-xabarlar yordamida muloqotni avtomatlashtiring.",
    step3_title: "O'lchang",
    step3_desc: "Statistikalar orqali natijalarni tahlil qiling va strategiyani optimallashtiring.",
    integrations_title: "Integratsiyalar",
    integrations_desc: "Google auth, Email, va boshqalar bilan osongina integratsiya qilinadi.",
    testimonials_title: "Foydalanuvchi fikrlari",
    testimonial1: "Sodda va kuchli — mijozlarimiz bilan muloqotni avtomatlashtirdik.",
    testimonial2: "Mass xabarlar va tahlillar yordamida kampaniyalarimiz natijasi yaxshilandi.",
    testimonial3: "Auto-replies funksiyasi va shablonlar juda foydali.",
  },
  en: {
    app_name: "Torex-Talk",
    tagline: "Telegram management and AI auto-reply platform",
    get_started: "Get Started",
    sign_in: "Sign In",
    dashboard: "Dashboard",
    admin_panel: "Admin Panel",
    features: "Features",
    pricing: "Pricing",
    language: "Language",
    hero_title: "Manage Telegram accounts, automate messaging",
    hero_sub: "Mass messaging, AI auto-replies, scheduling and analytics in one minimal app.",
    cta_primary: "Sign up",
    cta_secondary: "Log in",
    learn_more: "Learn more",
    quick_features: "Key features",
    feature_1_t: "Telegram-like chat UI",
    feature_1_d: "Private and Groups separated for fast control.",
    feature_2_t: "Mass messaging",
    feature_2_d: "Send one message to all private chats.",
    feature_3_t: "AI auto-reply",
    feature_3_d: "Train with unlimited Q&A pairs.",
    feature_4_t: "Scheduling & templates",
    feature_4_d: "Schedule messages and reuse templates.",
    feature_5_t: "Real-time notifications",
    feature_5_d: "Alerts for new messages and auto-replies.",
    feature_6_t: "Stats & analytics",
    feature_6_d: "Track sent messages and activity.",
    features_sub: "Core capabilities and practical use cases",
    feature_1_b1: "Separate private and group chats",
    feature_1_b2: "Fast search and filtering",
    feature_1_b3: "Pinned conversations",
    feature_2_b1: "Scheduled sending",
    feature_2_b2: "Segmentation and filters",
    feature_2_b3: "Safe rate limiting",
    feature_3_b1: "Train with Q&A pairs",
    feature_3_b2: "Confidence threshold with fallback",
    feature_3_b3: "Templated auto-replies",
    feature_4_b1: "Timezone-aware scheduling",
    feature_4_b2: "Recurring schedules",
    feature_4_b3: "Template variables",
    feature_5_b1: "Web push and email alerts",
    feature_5_b2: "Channel-based filters",
    feature_5_b3: "Real-time updates",
    feature_6_b1: "Open and reply metrics",
    feature_6_b2: "Average response time",
    feature_6_b3: "CSV/PDF export",
    plans_title: "Subscription Plans",
    plan_free: "Free / Basic",
    plan_plus: "Plus",
    plan_premium: "Premium",
    plan_free_benefit: "Up to 3 Telegram accounts",
    plan_plus_benefit: "Up to 10 Telegram accounts",
    plan_premium_benefit: "Unlimited accounts + advanced AI",
    choose_plan: "Choose plan",
    billing_monthly: "Monthly",
    billing_yearly: "Yearly",
    yearly_saving: "2 months free",
    includes: "What's included",
    all_plans_include: "All plans include",
    popular: "Most popular",
    compare_title: "Feature comparison",
    guarantee_title: "14-day money-back guarantee",
    guarantee_desc: "If it's not a fit, get a full refund within 14 days.",
    contact_cta: "Have questions? Contact us",
    selected: "Selected",
    label_seats: "Team seats",
    label_msgs: "Monthly message limit",
    label_support: "Support",
    label_api: "API access",
    label_integrations: "Integrations",
    label_audit: "Audit logs",
    support_none: "None",
    support_business: "Business hours",
    support_247: "24/7",
    payment_methods: "Payment methods",
    payment_list: "Visa, Mastercard, Payme, Click",
    faq_title: "Frequently Asked Questions",
    faq_q1: "What payment methods are supported?",
    faq_a1: "Visa/Mastercard, local providers, and invoicing are supported.",
    faq_q2: "Can I cancel anytime?",
    faq_a2: "Yes. Cancel anytime and you'll not be charged for the next period.",
    faq_q3: "Are there account limits?",
    faq_a3: "Basic: 3, Plus: 10, Premium: unlimited Telegram accounts.",
    footer_rights: "All rights reserved",
    footer_telegram_manager: "Telegram manager",
    footer_description: "Convenient platform for automating messages, mass messaging and AI auto-replies.",
    footer_documents: "Documents",
    footer_terms: "Terms of Service",
    footer_privacy: "Privacy Policy",
    footer_security: "Data Security",
    footer_support: "Support",
    footer_help: "Help",
    footer_partners: "Partnership",
    footer_contact: "Contact",
    footer_developer: "Developer:",
    how_it_works: "How it works",
    feature_mass_messaging_title: "Mass messaging",
    feature_mass_messaging_desc: "Send messages to hundreds of users at once through a single panel and schedule deliveries.",
    feature_ai_replies_title: "AI auto-replies",
    feature_ai_replies_desc: "Create automatic responses and templates for questions, with multiple answer options for one question.",
    feature_analytics_title: "Analytics and statistics",
    feature_analytics_desc: "Monitor campaign effectiveness, get open and response rates.",
    step1_title: "Connect account",
    step1_desc: "Register via Google or email and connect your Telegram account.",
    step2_title: "Automate",
    step2_desc: "Automate communication using auto-replies, templates and mass messages.",
    step3_title: "Measure",
    step3_desc: "Analyze results through statistics and optimize strategy.",
    integrations_title: "Integrations",
    integrations_desc: "Easily integrates with Google auth, Email, and more.",
    testimonials_title: "User reviews",
    testimonial1: "Simple and powerful — we automated communication with our clients.",
    testimonial2: "Mass messages and analytics helped improve our campaign results.",
    testimonial3: "Auto-replies feature and templates are very useful.",
  },
  ru: {
    app_name: "Torex-Talk",
    tagline: "Управление Telegram и AI-автоответы",
    get_started: "Начать",
    sign_in: "Войти",
    dashboard: "Панель",
    admin_panel: "Админ-панель",
    features: "Возможности",
    pricing: "Тарифы",
    language: "Язык",
    hero_title: "Управляйте аккаунтами Telegram и автоматизируйте сообщ��ния",
    hero_sub: "Массовые рассылки, AI-автоответы, расписание и аналитика в одном приложении.",
    cta_primary: "Зарегистрироваться",
    cta_secondary: "Войти",
    learn_more: "Подробнее",
    quick_features: "Ключевые возможности",
    feature_1_t: "Интерфейс как в Telegram",
    feature_1_d: "Личные и группы отдельно для удобного управления.",
    feature_2_t: "Массовые сообщения",
    feature_2_d: "Отправляйте одно сообщение всем личным чатам.",
    feature_3_t: "AI-автоответ",
    feature_3_d: "Обучение без ограничений Q&A.",
    feature_4_t: "Расписание и шаблоны",
    feature_4_d: "Планируйте сообщения и используйте шаблоны.",
    feature_5_t: "Уведомления в реальном времени",
    feature_5_d: "Оповещения о новых сообщениях и автоответах.",
    feature_6_t: "Статистика и аналитика",
    feature_6_d: "Отслеживайте отправленные сообщения �� активность.",
    features_sub: "Ключевые возможности и сценарии использования",
    feature_1_b1: "Отдельные личные и групповые чаты",
    feature_1_b2: "Быстрый поиск и фильтрация",
    feature_1_b3: "Закреплённые беседы",
    feature_2_b1: "Отправка по расписанию",
    feature_2_b2: "Сегментация и фильтры",
    feature_2_b3: "Безопасный rate limiting",
    feature_3_b1: "Обучение на Q&A парах",
    feature_3_b2: "Порог уверенности и fallback",
    feature_3_b3: "Шаблонные автоответы",
    feature_4_b1: "Учет часовых поясов",
    feature_4_b2: "Повторяющиеся расписания",
    feature_4_b3: "Переменные в шаблонах",
    feature_5_b1: "Web push и email уведомления",
    feature_5_b2: "Фильтры по каналам",
    feature_5_b3: "Обновления в реальном времени",
    feature_6_b1: "Метрики открытий и ответов",
    feature_6_b2: "Среднее время ответа",
    feature_6_b3: "Экспорт CSV/PDF",
    plans_title: "Подписки",
    plan_free: "Бесплатный / Базовый",
    plan_plus: "Плюс",
    plan_premium: "Премиум",
    plan_free_benefit: "До 3 аккаунтов Telegram",
    plan_plus_benefit: "До 10 аккаунтов Telegram",
    plan_premium_benefit: "Безлимитные аккаунты + продвинутый AI",
    choose_plan: "Выбрать тариф",
    billing_monthly: "Ежемесячно",
    billing_yearly: "Ежегодно",
    yearly_saving: "2 месяца бесплатно",
    includes: "Что включено",
    all_plans_include: "Во всех тарифах",
    popular: "Популярный",
    compare_title: "Сравнение возможностей",
    guarantee_title: "Гарантия возврата 14 дней",
    guarantee_desc: "Если сервис вам не подошёл — полный возврат в течение 14 дней.",
    contact_cta: "Остались вопросы? Свяжитесь с нами",
    selected: "Выбрано",
    label_seats: "Места в команде",
    label_msgs: "Лимит сообщений в месяц",
    label_support: "Поддержка",
    label_api: "Доступ к API",
    label_integrations: "Интеграции",
    label_audit: "Журналы аудита",
    support_none: "Нет",
    support_business: "В рабочие часы",
    support_247: "24/7",
    payment_methods: "Способы оплаты",
    payment_list: "Visa, Mastercard, Payme, Click",
    faq_title: "Частые вопросы",
    faq_q1: "Какие способы оплаты доступны?",
    faq_a1: "Поддерживаются Visa/Mastercard, локальные провайдеры и оплата по счёту.",
    faq_q2: "Могу ли я отменить в любое время?",
    faq_a2: "Да, отмена в любой момент. Следующий период не будет списан.",
    faq_q3: "Есть ли ограничения по аккаунтам?",
    faq_a3: "Basic: 3, Plus: 10, Premium: без ограничений на аккаунты Telegram.",
    footer_rights: "Все права защищены",
    footer_telegram_manager: "Менеджер Telegram",
    footer_description: "Удобная платформа для автоматизации сообщений, массовых рассылок и AI-автоответов.",
    footer_documents: "Документы",
    footer_terms: "Пользовательское соглашение",
    footer_privacy: "Политика конфиденциальности",
    footer_security: "Безопасность данных",
    footer_support: "Поддержка",
    footer_help: "Помощь",
    footer_partners: "Партнёрство",
    footer_contact: "Контакты",
    footer_developer: "Разработчик:",
    how_it_works: "Как это работает",
    feature_mass_messaging_title: "Массовая рассылка",
    feature_mass_messaging_desc: "Отправляйте сообщения сотням пользователей одновременно через единую панель и планируйте доставку.",
    feature_ai_replies_title: "AI-автоответы",
    feature_ai_replies_desc: "Создавайте автоматические ответы и шаблоны на вопросы, с несколькими вариантами ответов на один вопрос.",
    feature_analytics_title: "Аналитика и статистика",
    feature_analytics_desc: "Отслеживайте эффективность кампаний, получайте показатели открытий и ответов.",
    step1_title: "Подключить аккаунт",
    step1_desc: "Зарегистрируйтесь через Google или email и подключите свой аккаунт Telegram.",
    step2_title: "Автоматизировать",
    step2_desc: "Автоматизируйте общение с помощью автоответов, шаблонов и массовых сообщений.",
    step3_title: "Измерить",
    step3_desc: "Анализируйте результаты по статистике и оптимизируйте стратегию.",
    integrations_title: "Интеграции",
    integrations_desc: "Легко интегрируется с Google auth, Email и другими.",
    testimonials_title: "Отзывы пользователей",
    testimonial1: "Просто и мощно — мы автоматизировали общение с клиентами.",
    testimonial2: "Массовые сообщения и аналитика помогли улучшить результаты наших кампаний.",
    testimonial3: "Функция автоответов и шаблоны очень полезны.",
  },
};

function detectLocale(): Locale {
  const saved = localStorage.getItem("tt_locale") as Locale | null;
  if (saved) return saved;
  const n = navigator.language.toLowerCase();
  if (n.startsWith("uz")) return "uz";
  if (n.startsWith("ru")) return "ru";
  return "en";
}

interface I18nCtx {
  locale: Locale;
  setLocale: (l: Locale) => void;
  t: (key: string) => string;
}

const Ctx = createContext<I18nCtx | null>(null);

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [locale, setLocaleState] = useState<Locale>("uz");

  useEffect(() => {
    setLocaleState(detectLocale());
  }, []);

  const setLocale = (l: Locale) => {
    localStorage.setItem("tt_locale", l);
    setLocaleState(l);
    document.documentElement.lang = l;
  };

  const t = useMemo(() => {
    return (key: string) => messages[locale]?.[key] ?? key;
  }, [locale]);

  const value = useMemo(() => ({ locale, setLocale, t }), [locale]);

  return <Ctx.Provider value={value}>{children}</Ctx.Provider>;
}

export function useI18n() {
  const ctx = useContext(Ctx);
  if (!ctx) throw new Error("useI18n must be used within I18nProvider");
  return ctx;
}
