import{r as d,j as s}from"./ui-E7op3xd6.js";import{u as E,B as v}from"./index-DGb-t3le.js";import"./vendor-Bs7gn1Hv.js";import"./query-28qq_-a4.js";import"./router-pxkjurEI.js";import"./motion-wg93wq_x.js";function Q(){const{user:o,updateUser:J}=E(),[i,m]=d.useState([]),[p,f]=d.useState(""),[h,g]=d.useState("");d.useEffect(()=>{if(!o)return;const e=localStorage.getItem(`tt_qas_${o.email}`);if(!e){m([]);return}try{const a=JSON.parse(e);if(Array.isArray(a)){const t=a.map(r=>({id:r.id??Math.random().toString(36).slice(2),q:r.q??"",answers:r.answers??(r.a?[r.a]:[])}));m(t)}else m([])}catch(a){console.error("Failed to parse stored auto-replies",a),m([])}},[o]);const c=e=>{o&&(localStorage.setItem(`tt_qas_${o.email}`,JSON.stringify(e)),m(e))},w=e=>c(i.filter(a=>a.id!==e)),b=(e,a)=>{a.trim()&&c(i.map(t=>t.id===e?{...t,answers:[...t.answers,a.trim()]}:t))},N=(e,a)=>{c(i.map(t=>t.id===e?{...t,answers:t.answers.filter((r,l)=>l!==a)}:t))},y=(e,a)=>c(i.map(t=>t.id===e?{...t,q:a}:t)),S=(e,a,t)=>c(i.map(r=>r.id===e?{...r,answers:r.answers.map((l,n)=>n===a?t:l)}:r)),A=()=>{const e=JSON.stringify(i,null,2),a=new Blob([e],{type:"application/json"}),t=URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download=`torex_qas_${o?.email??"export"}.json`,r.click(),URL.revokeObjectURL(t)},q=e=>{const a=e.target.files?.[0];if(!a)return;const t=new FileReader;t.onload=()=>{try{const r=JSON.parse(String(t.result));if(Array.isArray(r)){const l=r.map(n=>({id:n.id??Math.random().toString(36).slice(2),q:n.q??"",answers:n.answers??(n.a?[n.a]:[])}));c([...i,...l])}}catch(r){console.error(r)}},t.readAsText(a)};if(!o)return s.jsx("div",{className:"py-10 px-6",children:"Iltimos tizimga kiring"});function j({value:e,onSave:a}){const[t,r]=d.useState(!1),[l,n]=d.useState(e);return t?s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{className:"w-full sm:w-auto flex-1 rounded-md bg-secondary px-2 py-1",value:l,onChange:u=>n(u.target.value)}),s.jsx("button",{onClick:()=>{a(l),r(!1)},className:"px-2 py-1 rounded bg-primary text-primary-foreground",children:"Saqlash"}),s.jsx("button",{onClick:()=>{n(e),r(!1)},className:"px-2 py-1 rounded bg-secondary",children:"Bekor"})]}):s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{children:e}),s.jsx("button",{onClick:()=>r(!0),className:"text-xs text-muted-foreground underline",children:"Tahrirlash"})]})}function k({item:e,onEdit:a,onRemove:t,onAdd:r}){const[l,n]=d.useState("");return s.jsxs("div",{className:"space-y-2",children:[e.answers.map((u,x)=>s.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-2",children:[s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx(j,{value:u,onSave:C=>a(x,C)})}),s.jsx("div",{className:"flex items-center gap-2 self-end sm:self-auto",children:s.jsx("button",{onClick:()=>t(x),className:"px-2 py-1 rounded bg-destructive text-destructive-foreground text-sm",children:"O'chirish"})})]},x)),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-2",children:[s.jsx("input",{placeholder:"Yangi javob",value:l,onChange:u=>n(u.target.value),className:"w-full flex-1 rounded-md bg-secondary px-3 py-2"}),s.jsx("button",{onClick:()=>{r(l),n("")},className:"w-full sm:w-auto px-3 py-2 rounded bg-primary text-primary-foreground",children:"Javob qo'shish"})]})]})}return s.jsx("div",{className:"py-8 px-6",children:s.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"AI Avtojavoblar"}),s.jsx("div",{className:"space-y-3",children:i.map(e=>s.jsx("div",{className:"border rounded p-3",children:s.jsxs("div",{className:"flex items-start justify-between gap-4 flex-col sm:flex-row",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"font-medium mb-2",children:["Q:"," ",s.jsx(j,{value:e.q,onSave:a=>y(e.id,a)})]}),s.jsx("div",{className:"space-y-2",children:s.jsx(k,{item:e,onEdit:(a,t)=>S(e.id,a,t),onRemove:a=>N(e.id,a),onAdd:a=>b(e.id,a)})})]}),s.jsx("div",{className:"flex sm:flex-col gap-2 sm:gap-3 mt-4 sm:mt-0",children:s.jsx("button",{onClick:()=>w(e.id),className:"px-2 py-1 rounded bg-destructive text-destructive-foreground",children:"O'chirish"})})]})},e.id))})]}),s.jsxs("div",{className:"rounded-xl border p-4 bg-card md:sticky md:top-4",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Yangi Q&A"}),s.jsx("input",{className:"w-full rounded-md bg-secondary px-3 py-2 mb-2",placeholder:"Savol",value:p,onChange:e=>f(e.target.value)}),s.jsx("textarea",{className:"w-full rounded-md bg-secondary px-3 py-2 mb-2",placeholder:"Javob(lar) - har bir javob yangi qatorga",value:h,onChange:e=>g(e.target.value)}),s.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-2",children:[s.jsx(v,{className:"w-full sm:w-auto",onClick:()=>{const e=h.split(`
`).map(t=>t.trim()).filter(Boolean);if(!p.trim())return;const a=[...i,{id:Math.random().toString(36).slice(2),q:p.trim(),answers:e}];c(a),f(""),g("")},children:"Qo'shish"}),s.jsx(v,{className:"w-full sm:w-auto",variant:"outline",onClick:A,children:"Export"}),s.jsxs("label",{className:"px-3 py-2 rounded bg-secondary cursor-pointer w-full sm:w-auto text-center",children:["Import",s.jsx("input",{type:"file",accept:"application/json",onChange:q,className:"hidden"})]})]})]})]})})}export{Q as default};
