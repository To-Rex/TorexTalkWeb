const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DGb-t3le.js","assets/ui-E7op3xd6.js","assets/vendor-Bs7gn1Hv.js","assets/query-28qq_-a4.js","assets/router-pxkjurEI.js","assets/motion-wg93wq_x.js","assets/index-DojNIePZ.css"])))=>i.map(i=>d[i]);
import{j as e,r as s,o as Je,b as Tt,M as Ot,c as zt,N as Et,u as Qe,P as Le,e as le,A as Ye,d as Ze,i as Ft,O as qt,Q as Gt,U as $t,W as Bt,X as Ut,D as Ht,C as Kt,s as Vt,Y as Jt,Z as Qt,$ as Xe,a0 as Yt,a1 as We,a2 as et,a3 as tt,a4 as Zt,a5 as Xt,a6 as at,a7 as Wt,a8 as ea,a9 as nt,aa as ta,ab as st,ac as aa,ad as na,ae as it,af as rt,ag as ot,ah as lt}from"./ui-E7op3xd6.js";import{I as ne}from"./input-Ixjctc5o.js";import{c as q,a as z,C as sa,b as ia,X as ue,u as ie,d as xe,D as Ne,e as Ce,B as O,f as Se,g as H,h as ke,i as ra,j as oa,k as la,l as ca,_ as ve,m as da,n as me}from"./index-DGb-t3le.js";import{C as De}from"./chevron-down-3PgKoVA8.js";import"./vendor-Bs7gn1Hv.js";import"./query-28qq_-a4.js";import"./router-pxkjurEI.js";import"./motion-wg93wq_x.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Ge=q("arrow-down",ma);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],xa=q("arrow-left",ha);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],pa=q("calendar",ua);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],ye=q("check-check",fa);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],va=q("chevron-up",ga);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],ja=q("ellipsis-vertical",ya);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ka=q("loader-circle",ba);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],$e=q("map-pin",wa);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Na=q("mic",La);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],Sa=q("paperclip",Ca);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],_a=q("pause",Da);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],we=q("play",Ma);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Pa=q("search",Ia);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Aa=q("send",Ra);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Oa=q("user-x",Ta);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Be=q("user",za);function W({className:a,...i}){return e.jsx("div",{className:z("animate-pulse rounded-md bg-muted",a),...i})}function Ue({chats:a,currentId:i,onSelect:n,onCreateChat:o,user:l,collapsed:r=!1,onToggleCollapsed:m,loadingPrivate:u=!1,loadingGroups:w=!1,emptyMessage:y="Chatlar yo'q",tab:j="private",onTabChange:c}){const[d,b]=s.useState(""),I=d.trim().toLowerCase(),f=a.filter(g=>g.type===j&&(!I||g.name.toLowerCase().includes(I))),R=I?[{name:"Dilshodjon Haydarov",type:"private"},{name:"Frontend Devs",type:"group"},{name:"Marketing",type:"group"},{name:"Support",type:"private"}].filter(g=>g.type===j&&g.name.toLowerCase().includes(I)&&!a.some(A=>A.type===g.type&&A.name===g.name)):[];return e.jsxs("aside",{className:`${r?"w-16":"w-full md:w-64 lg:w-72"} border-r bg-secondary/30 flex flex-col h-full min-h-0 transition-all duration-200`,children:[m&&e.jsxs("div",{className:"flex justify-between items-center p-2 shrink-0",children:[!r&&e.jsx("div",{className:"text-sm font-medium",children:"Chat"}),e.jsx("button",{onClick:m,className:"inline-flex items-center justify-center rounded-md p-2 text-sm hover:bg-background","aria-label":r?"Expand sidebar":"Collapse sidebar",title:r?"Kengaytirish":"Qisqartirish",children:r?e.jsx(sa,{className:"h-4 w-4"}):e.jsx(ia,{className:"h-4 w-4"})})]}),!r&&e.jsxs("div",{className:"p-3 flex gap-2 shrink-0",children:[e.jsx("button",{onClick:()=>c?.("private"),className:`flex-1 px-3 py-2 rounded-md text-sm ${j==="private"?"bg-background":"hover:bg-background/50"}`,children:"Private"}),e.jsx("button",{onClick:()=>c?.("group"),className:`flex-1 px-3 py-2 rounded-md text-sm ${j==="group"?"bg-background":"hover:bg-background/50"}`,children:"Groups"})]}),!r&&e.jsx("div",{className:"px-3 pb-2 shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Pa,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ne,{value:d,onChange:g=>b(g.target.value),placeholder:j==="private"?"Foydalanuvchi qidirish":"Guruh qidirish",className:"pl-8 pr-8"}),d?e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>b(""),"aria-label":"Tozalash",children:e.jsx(ue,{className:"h-4 w-4"})}):null]})}),e.jsx("div",{className:"p-2 space-y-1 flex-1 min-h-0 overflow-y-auto",children:j==="private"&&u||j==="group"&&w?Array.from({length:4}).map((g,A)=>e.jsxs("div",{className:`flex items-center ${r?"justify-center px-1":"gap-3 px-3"} py-2`,children:[e.jsx(W,{className:`${r?"h-8 w-8":"h-10 w-10"} rounded-full`}),!r&&e.jsx(W,{className:"h-4 flex-1"})]},A)):f.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:y}):e.jsxs(e.Fragment,{children:[f.map(g=>e.jsxs("button",{onClick:()=>n(g.id),className:`w-full flex items-center justify-between rounded-lg ${r?"px-1":"px-3"} py-2 text-left ${i===g.id?"bg-background border":"hover:bg-background/60"}`,children:[e.jsxs("div",{className:`flex items-center ${r?"justify-center":"gap-3"}`,children:[g.avatar==="deleted"?e.jsx("div",{className:`${r?"h-8 w-8":"h-10 w-10"} rounded-full bg-muted flex items-center justify-center`,children:e.jsx(Oa,{className:`${r?"h-4 w-4":"h-5 w-5"} text-muted-foreground`})}):g.avatar?e.jsx("img",{src:g.avatar,alt:g.name,className:`${r?"h-8 w-8":"h-10 w-10"} rounded-full object-cover`}):e.jsx("div",{className:`${r?"h-8 w-8":"h-10 w-10"} rounded-full bg-primary text-white grid place-items-center font-semibold ${r?"text-xs":""}`,children:g.name.split(" ").map(A=>A[0]).slice(0,2).join("")}),!r&&e.jsx("div",{className:"text-sm",children:g.name})]}),g.unread?e.jsx("span",{className:"text-[10px] rounded bg-primary text-primary-foreground px-1.5 py-0.5",children:g.unread}):null]},g.id)),!r&&R.length>0?e.jsxs("div",{className:"pt-2",children:[e.jsx("div",{className:"px-2 py-1 text-[10px] uppercase tracking-wide text-muted-foreground",children:"Natijalar"}),R.map(g=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg hover:bg-background/60",children:[e.jsx("div",{className:"text-sm",children:g.name}),o?e.jsx("button",{onClick:()=>o({name:g.name,type:g.type}),className:"text-xs rounded px-2 py-1 border hover:bg-background",children:"Chat boshlash"}):null]},`${g.type}:${g.name}`))]}):null]})})]})}function He({src:a}){const i=s.useRef(null),[n,o]=s.useState(!1),[l,r]=s.useState(0),[m,u]=s.useState(!1);s.useEffect(()=>{const d=i.current;if(!d)return;const b=new IntersectionObserver(([I])=>{u(I.isIntersecting),I.isIntersecting||(d.pause(),o(!1))},{threshold:.5});return b.observe(d),()=>b.disconnect()},[]),s.useEffect(()=>{const d=i.current;if(!d)return;const b=()=>{r(d.currentTime/d.duration*100)},I=()=>{o(!1),r(0)};return d.addEventListener("timeupdate",b),d.addEventListener("ended",I),()=>{d.removeEventListener("timeupdate",b),d.removeEventListener("ended",I)}},[a]);const w=()=>{const d=i.current;d&&(n?d.pause():(window.dispatchEvent(new CustomEvent("pauseAllVideoNotes")),d.muted=!1,d.play()),o(!n))};s.useEffect(()=>{const d=()=>{const b=i.current;b&&n&&(b.pause(),o(!1))};return window.addEventListener("pauseAllVideoNotes",d),()=>window.removeEventListener("pauseAllVideoNotes",d)},[n]);const y=2*Math.PI*45,j=y,c=y-l/100*y;return e.jsxs("div",{className:"relative w-48 h-48",children:[e.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"2"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"white",strokeWidth:"2",strokeDasharray:j,strokeDashoffset:c,transform:"rotate(-90 50 50)",style:{transition:"stroke-dashoffset 0.1s linear"}})]}),e.jsx("video",{ref:i,src:a,className:"w-full h-full rounded-full object-cover",muted:!0,playsInline:!0,onPlay:()=>o(!0),onPause:()=>o(!1)}),e.jsx("button",{onClick:w,className:"absolute inset-0 flex items-center justify-center bg-black/20 rounded-full",children:n?e.jsx(_a,{className:"h-8 w-8 text-white"}):e.jsx(we,{className:"h-8 w-8 text-white"})})]})}function Ke({title:a,status:i,messages:n,onBack:o,collapsed:l=!1,avatar:r,memberCount:m,onlineCount:u,onLoadMore:w,isLoadingMore:y,loadingMessages:j}){const c=s.useRef(null),d=s.useRef(null),{user:b,addToBlocklist:I,removeFromBlocklist:f}=ie(),[G,R]=s.useState(!1),g=s.useRef(!0),A=s.useRef(n.length),U=s.useRef(!1),Y=s.useRef(!1),K=s.useRef(null),V=s.useRef(0),J=s.useRef(null),[p,D]=s.useState(!1),L=s.useRef(p),h=s.useRef(y);s.useEffect(()=>{L.current=p},[p]),s.useEffect(()=>{h.current=y},[y]);const _=(b?.blocklist??[]).includes(a),E=()=>{b&&(_?f(a):I(a))};s.useLayoutEffect(()=>{if(g.current&&n.length>0&&c.current){if(d.current)d.current.scrollIntoView({behavior:"auto"});else{const N=c.current.style&&c.current.style.scrollBehavior||"";try{c.current.style.scrollBehavior="auto"}catch{}c.current.scrollTop=c.current.scrollHeight;try{c.current.style.scrollBehavior=N}catch{}}g.current=!1;try{V.current=Date.now()}catch{}}},[n.length]),s.useLayoutEffect(()=>{if(K.current&&c.current){D(!0);const{prevScrollHeight:N,prevScrollTop:S}=K.current,T=c.current.scrollHeight,M=S+(T-N),B=c.current.style&&c.current.style.scrollBehavior||"";try{c.current.style.scrollBehavior="auto"}catch{}c.current.scrollTop=M;try{c.current.style.scrollBehavior=B}catch{}K.current=null,D(!1)}},[n.length]),s.useEffect(()=>{if(n.length>A.current&&c.current&&!g.current){const{scrollTop:N,scrollHeight:S,clientHeight:T}=c.current;N+T>=S-100&&c.current.scrollTo({top:c.current.scrollHeight,behavior:"smooth"})}A.current=n.length},[n.length]),s.useEffect(()=>{if(!w)return;const N=()=>{if(g.current)return;const T=c.current;if(!T)return;const{scrollTop:M,scrollHeight:B,clientHeight:$}=T;if(Y.current=M+$>=B-100,M<=20?U.current||(console.log("Siz yetib keldingiz."),U.current=!0):U.current=!1,M<=5&&!h.current&&!L.current){const ee=Date.now();if(ee-V.current<500)return;V.current=ee,K.current={prevScrollHeight:B,prevScrollTop:M},console.log("Calling onLoadMore"),w()}},S=c.current;if(S)return S.addEventListener("scroll",N),()=>S.removeEventListener("scroll",N)},[w]),s.useEffect(()=>{if(!b)return;const N=`tt_ar_${b.email}_${a}`,S=localStorage.getItem(N);R(S==="1")},[b,a]);const Q=()=>{if(!b)return;const N=`tt_ar_${b.email}_${a}`,S=!G;R(S),localStorage.setItem(N,S?"1":"0")};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b px-4 py-2 bg-background/80 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:[e.jsxs("div",{className:"font-medium flex items-center gap-3",children:[o?e.jsx("button",{className:"md:hidden -ml-2 mr-1 inline-flex items-center justify-center rounded p-2 hover:bg-accent/40",onClick:o,"aria-label":"Orqaga",title:"Orqaga",children:e.jsx(xa,{className:"h-4 w-4"})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsx("img",{src:r,alt:a,className:"w-6 h-6 rounded-full object-cover"}),e.jsx("div",{children:a})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:m!==void 0&&u!==void 0?`${m.toLocaleString()} members, ${u} online`:i})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("input",{type:"checkbox",checked:G,onChange:Q})," ","Auto-reply"]}),e.jsxs("button",{onClick:E,disabled:!a,className:`text-xs rounded px-2 py-1 border ${_?"bg-destructive text-destructive-foreground border-destructive":"hover:bg-background"} ${a?"":"opacity-50 cursor-not-allowed"}`,title:_?"Mass xabardan chiqarish":"Mass xabardan bloklash",children:[e.jsx("div",{ref:J,className:"w-full h-[1px]","aria-hidden":"true"}),_?"Blokdan chiqarish":"Mass xabardan bloklash"]})]})]}),e.jsxs("div",{ref:c,className:"relative flex-1 overflow-auto p-3 space-y-2 bg-background scroll-smooth",children:[j&&n.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-start",children:e.jsx(W,{className:"h-10 w-48 rounded-lg"})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(W,{className:"h-10 w-32 rounded-lg"})}),e.jsx("div",{className:"flex justify-start",children:e.jsx(W,{className:"h-12 w-56 rounded-lg"})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(W,{className:"h-8 w-40 rounded-lg"})}),e.jsx("div",{className:"flex justify-start",children:e.jsx(W,{className:"h-10 w-44 rounded-lg"})})]}):(()=>{const N=[];let S=[],T="";return n.forEach(M=>{M.chatType==="supergroup"&&M.sender!=="me"&&M.file?.type!=="video_note"?M.sender!==T?(S.length>0&&N.push(S),S=[M],T=M.sender):S.push(M):(S.length>0&&(N.push(S),S=[],T=""),N.push([M]))}),S.length>0&&N.push(S),N.map((M,B)=>{const $=M[0],ee=$.chatType==="supergroup",te=$.sender==="me",re=B===N.length-1;return ee&&!te?e.jsxs("div",{className:"flex gap-2 relative",ref:re?d:null,children:[e.jsx("div",{className:"sticky top-0 self-start",children:$.userPhoto?e.jsx("img",{src:$.userPhoto,alt:$.sender,className:"w-8 h-8 rounded-full object-cover flex-shrink-0"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-500 flex items-center justify-center text-xs flex-shrink-0",children:$.sender.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex flex-col max-w-[80%]",children:[$.file?.type!=="video_note"&&$.file?.type!=="image"&&e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:$.sender==="them"?a:$.sender}),M.map(t=>e.jsxs("div",{className:`w-fit mb-1 ${t.file?.type==="video_note"||t.file?.type==="image"||t.file?.type==="document"?"":"rounded-lg px-3 py-2 text-sm text-white bg-secondary"}`,children:[t.text&&t.file?.type!=="video_note"?e.jsx("div",{className:"mb-1 whitespace-pre-wrap",children:t.text}):null,t.file?t.file.type==="image"?e.jsxs("div",{className:"relative inline-block mt-1",children:[e.jsx("img",{src:t.file.url,alt:t.file.name??"image",className:"max-w-[300px] rounded-lg cursor-pointer",onClick:()=>window.open(t.file.url,"_blank")}),e.jsxs("div",{className:"absolute bottom-1 right-1 bg-black/50 text-white text-[10px] px-1 py-0.5 rounded flex items-center gap-1",children:[new Date(t.at).toLocaleTimeString(),te&&t.is_outgoing&&(t.is_read?e.jsx(ye,{className:"h-3 w-3"}):e.jsx(xe,{className:"h-3 w-3"}))]})]}):t.file.type==="video"?e.jsx("video",{src:t.file.url,controls:!0,className:"max-w-[300px] rounded-lg mt-1",style:{borderRadius:"12px"}}):t.file.type==="video_note"?e.jsx(He,{src:t.file.url}):t.file.type==="audio"?e.jsxs("div",{className:"mt-1 flex items-center gap-2 bg-secondary/50 rounded-lg p-2 max-w-[250px]",children:[e.jsx("button",{className:"flex items-center justify-center w-8 h-8 bg-primary rounded-full",children:e.jsx(we,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Audio"}),t.file.duration&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.floor(t.file.duration/60),":",(t.file.duration%60).toString().padStart(2,"0")]})]}),e.jsx("audio",{src:t.file.url})]}):t.file.type==="document"?e.jsxs("div",{className:"mt-1 flex items-center gap-3 bg-secondary/50 rounded-lg p-3 max-w-[250px]",children:[e.jsx("a",{href:t.file.url,download:t.file.name,className:"flex items-center justify-center w-10 h-10 bg-primary rounded-full hover:bg-primary/80",children:e.jsx(Ge,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:t.file.name??"File"}),t.file.size&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[(t.file.size/1024/1024).toFixed(1)," MB"]})]})]}):t.file.type==="location"?e.jsx("div",{className:"mt-1 rounded-lg bg-secondary/50 border p-3 max-w-[250px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:"Location"}),t.file.name&&e.jsx("div",{className:"text-xs text-muted-foreground",children:t.file.name})]}),e.jsx("a",{href:t.file.url,target:"_blank",rel:"noreferrer",className:"text-xs rounded px-2 py-1 border hover:bg-background",children:"View"})]})}):t.file.type==="contact"?e.jsx("div",{className:"mt-1 rounded-lg bg-secondary/50 border p-3 max-w-[250px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm",children:[t.file.contact?.first_name," ",t.file.contact?.last_name||""]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.file.contact?.phone_number})]})]})}):null:null,t.file?.type!=="image"&&e.jsx("div",{className:"text-[10px] text-white mt-1",children:new Date(t.at).toLocaleTimeString()})]},t.id))]})]},`group-${B}`):M.map((t,Z)=>e.jsxs("div",{className:`w-fit max-w-[80%] ${t.file?.type==="video_note"||t.file?.type==="image"||t.file?.type==="document"?"":`rounded-lg px-3 py-2 text-sm text-white ${te?"ml-auto bg-primary":"bg-secondary"}`}`,ref:re&&Z===M.length-1?d:null,children:[t.sender!=="me"&&t.file?.type!=="video_note"&&t.file?.type!=="image"&&t.file?.type!=="document"?e.jsx("div",{className:"text-xs font-medium text-white mb-1",children:t.sender==="them"?a:t.sender}):null,t.text&&t.file?.type!=="video_note"?e.jsx("div",{className:"mb-1 whitespace-pre-wrap",children:t.text}):null,t.file?t.file.type==="image"?e.jsxs("div",{className:"relative inline-block mt-1",children:[e.jsx("img",{src:t.file.url,alt:t.file.name??"image",className:"max-w-[300px] rounded-lg cursor-pointer",onClick:()=>window.open(t.file.url,"_blank")}),e.jsxs("div",{className:"absolute bottom-1 right-1 bg-black/50 text-white text-[10px] px-1 py-0.5 rounded flex items-center gap-1",children:[new Date(t.at).toLocaleTimeString(),te&&t.is_outgoing&&(t.is_read?e.jsx(ye,{className:"h-3 w-3"}):e.jsx(xe,{className:"h-3 w-3"}))]})]}):t.file.type==="video"?e.jsx("video",{src:t.file.url,controls:!0,className:"max-w-[300px] rounded-lg mt-1",style:{borderRadius:"12px"}}):t.file.type==="video_note"?e.jsx(He,{src:t.file.url}):t.file.type==="audio"?e.jsxs("div",{className:"mt-1 flex items-center gap-2 bg-secondary/50 rounded-lg p-2 max-w-[250px]",children:[e.jsx("button",{className:"flex items-center justify-center w-8 h-8 bg-primary rounded-full",children:e.jsx(we,{className:"h-4 w-4 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Audio"}),t.file.duration&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.floor(t.file.duration/60),":",(t.file.duration%60).toString().padStart(2,"0")]})]}),e.jsx("audio",{src:t.file.url})]}):t.file.type==="document"?e.jsxs("div",{className:"mt-1 flex items-center gap-3 bg-secondary/50 rounded-lg p-3 max-w-[250px]",children:[e.jsx("a",{href:t.file.url,download:t.file.name,className:"flex items-center justify-center w-10 h-10 bg-primary rounded-full hover:bg-primary/80",children:e.jsx(Ge,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:t.file.name??"File"}),t.file.size&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[(t.file.size/1024/1024).toFixed(1)," MB"]})]})]}):t.file.type==="location"?e.jsx("div",{className:"mt-1 rounded-lg bg-secondary/50 border p-3 max-w-[250px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:"Location"}),t.file.name&&e.jsx("div",{className:"text-xs text-muted-foreground",children:t.file.name})]}),e.jsx("a",{href:t.file.url,target:"_blank",rel:"noreferrer",className:"text-xs rounded px-2 py-1 border hover:bg-background",children:"View"})]})}):t.file.type==="contact"?e.jsx("div",{className:"mt-1 rounded-lg bg-secondary/50 border p-3 max-w-[250px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-sm",children:[t.file.contact?.first_name," ",t.file.contact?.last_name||""]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.file.contact?.phone_number})]})]})}):null:null,t.file?.type!=="image"&&e.jsxs("div",{className:"text-[10px] text-white mt-1 flex items-center gap-1",children:[new Date(t.at).toLocaleTimeString(),te&&t.is_outgoing&&(t.is_read?e.jsx(ye,{className:"h-3 w-3"}):e.jsx(xe,{className:"h-3 w-3"}))]})]},t.id))})})(),y&&e.jsx("div",{className:"absolute left-0 right-0 top-0 flex justify-center pt-2 z-10 pointer-events-none",children:e.jsxs("div",{className:"flex items-center gap-2 bg-background/80 rounded px-3 py-1 backdrop-blur border",children:[e.jsx(ka,{className:"h-4 w-4 animate-spin"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Yuklanmoqda..."})]})})]})]})}var pe="Popover",[ct,Nn]=zt(pe,[Je]),ce=Je(),[Ea,X]=ct(pe),dt=a=>{const{__scopePopover:i,children:n,open:o,defaultOpen:l,onOpenChange:r,modal:m=!1}=a,u=ce(i),w=s.useRef(null),[y,j]=s.useState(!1),[c,d]=Tt({prop:o,defaultProp:l??!1,onChange:r,caller:pe});return e.jsx(Ot,{...u,children:e.jsx(Ea,{scope:i,contentId:Et(),triggerRef:w,open:c,onOpenChange:d,onOpenToggle:s.useCallback(()=>d(b=>!b),[d]),hasCustomAnchor:y,onCustomAnchorAdd:s.useCallback(()=>j(!0),[]),onCustomAnchorRemove:s.useCallback(()=>j(!1),[]),modal:m,children:n})})};dt.displayName=pe;var mt="PopoverAnchor",Fa=s.forwardRef((a,i)=>{const{__scopePopover:n,...o}=a,l=X(mt,n),r=ce(n),{onCustomAnchorAdd:m,onCustomAnchorRemove:u}=l;return s.useEffect(()=>(m(),()=>u()),[m,u]),e.jsx(Ye,{...r,...o,ref:i})});Fa.displayName=mt;var ht="PopoverTrigger",xt=s.forwardRef((a,i)=>{const{__scopePopover:n,...o}=a,l=X(ht,n),r=ce(n),m=Qe(i,l.triggerRef),u=e.jsx(Le.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":vt(l.open),...o,ref:m,onClick:le(a.onClick,l.onOpenToggle)});return l.hasCustomAnchor?u:e.jsx(Ye,{asChild:!0,...r,children:u})});xt.displayName=ht;var _e="PopoverPortal",[qa,Ga]=ct(_e,{forceMount:void 0}),ut=a=>{const{__scopePopover:i,forceMount:n,children:o,container:l}=a,r=X(_e,i);return e.jsx(qa,{scope:i,forceMount:n,children:e.jsx(Ze,{present:n||r.open,children:e.jsx(Ft,{asChild:!0,container:l,children:o})})})};ut.displayName=_e;var se="PopoverContent",pt=s.forwardRef((a,i)=>{const n=Ga(se,a.__scopePopover),{forceMount:o=n.forceMount,...l}=a,r=X(se,a.__scopePopover);return e.jsx(Ze,{present:o||r.open,children:r.modal?e.jsx(Ba,{...l,ref:i}):e.jsx(Ua,{...l,ref:i})})});pt.displayName=se;var $a=$t("PopoverContent.RemoveScroll"),Ba=s.forwardRef((a,i)=>{const n=X(se,a.__scopePopover),o=s.useRef(null),l=Qe(i,o),r=s.useRef(!1);return s.useEffect(()=>{const m=o.current;if(m)return qt(m)},[]),e.jsx(Gt,{as:$a,allowPinchZoom:!0,children:e.jsx(ft,{...a,ref:l,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:le(a.onCloseAutoFocus,m=>{m.preventDefault(),r.current||n.triggerRef.current?.focus()}),onPointerDownOutside:le(a.onPointerDownOutside,m=>{const u=m.detail.originalEvent,w=u.button===0&&u.ctrlKey===!0,y=u.button===2||w;r.current=y},{checkForDefaultPrevented:!1}),onFocusOutside:le(a.onFocusOutside,m=>m.preventDefault(),{checkForDefaultPrevented:!1})})})}),Ua=s.forwardRef((a,i)=>{const n=X(se,a.__scopePopover),o=s.useRef(!1),l=s.useRef(!1);return e.jsx(ft,{...a,ref:i,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{a.onCloseAutoFocus?.(r),r.defaultPrevented||(o.current||n.triggerRef.current?.focus(),r.preventDefault()),o.current=!1,l.current=!1},onInteractOutside:r=>{a.onInteractOutside?.(r),r.defaultPrevented||(o.current=!0,r.detail.originalEvent.type==="pointerdown"&&(l.current=!0));const m=r.target;n.triggerRef.current?.contains(m)&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&l.current&&r.preventDefault()}})}),ft=s.forwardRef((a,i)=>{const{__scopePopover:n,trapFocus:o,onOpenAutoFocus:l,onCloseAutoFocus:r,disableOutsidePointerEvents:m,onEscapeKeyDown:u,onPointerDownOutside:w,onFocusOutside:y,onInteractOutside:j,...c}=a,d=X(se,n),b=ce(n);return Bt(),e.jsx(Ut,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:l,onUnmountAutoFocus:r,children:e.jsx(Ht,{asChild:!0,disableOutsidePointerEvents:m,onInteractOutside:j,onEscapeKeyDown:u,onPointerDownOutside:w,onFocusOutside:y,onDismiss:()=>d.onOpenChange(!1),children:e.jsx(Kt,{"data-state":vt(d.open),role:"dialog",id:d.contentId,...b,...c,ref:i,style:{...c.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),gt="PopoverClose",Ha=s.forwardRef((a,i)=>{const{__scopePopover:n,...o}=a,l=X(gt,n);return e.jsx(Le.button,{type:"button",...o,ref:i,onClick:le(a.onClick,()=>l.onOpenChange(!1))})});Ha.displayName=gt;var Ka="PopoverArrow",Va=s.forwardRef((a,i)=>{const{__scopePopover:n,...o}=a,l=ce(n);return e.jsx(Vt,{...l,...o,ref:i})});Va.displayName=Ka;function vt(a){return a?"open":"closed"}var Ja=dt,Qa=xt,Ya=ut,yt=pt;const Za=Ja,Xa=Qa,jt=s.forwardRef(({className:a,align:i="center",sideOffset:n=4,...o},l)=>e.jsx(Ya,{children:e.jsx(yt,{ref:l,align:i,sideOffset:n,className:z("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})}));jt.displayName=yt.displayName;function Ve({onSend:a}){const[i,n]=s.useState(""),[o,l]=s.useState(""),[r,m]=s.useState(null),[u,w]=s.useState(null),y=["Salom! Sizga qanday yordam bera olaman?","Rahmat! Tez orada aloqaga chiqamiz.","Bugungi taklif: chegirma 20% faqat bugun!"],j=s.useRef(null),c=s.useRef(null),d=s.useRef(null),[b,I]=s.useState(!1),f=s.useRef(null),G=s.useRef(!1),R=s.useRef(!1),g=()=>{n(""),m(null),w(null),l(""),j.current&&(j.current.value=""),c.current&&(c.current.value=""),d.current&&(d.current.value="")},A=()=>{const h=!!i.trim(),_=!!r&&!!u;if(!h&&!_)return;const Q=(o?new Date(o).getTime():0)-Date.now(),N=()=>{_&&r&&u&&a({attachment:{type:u,file:r}}),h&&a({text:i.trim()})};if(o&&Q>0){window.setTimeout(N,Q),g();return}N(),g()},U=()=>{w("image"),j.current?.click()},Y=()=>{w("audio"),c.current?.click()},K=()=>{w("document"),d.current?.click()},V=()=>{if(!navigator.geolocation){a({text:"Lokatsiyani ulash uchun geolokatsiya qo'llab-quvvatlanmaydi"});return}navigator.geolocation.getCurrentPosition(h=>{const{latitude:_,longitude:E}=h.coords,Q=`https://maps.google.com/?q=${_},${E}`;a({attachment:{type:"location",url:Q,name:`${_.toFixed(5)}, ${E.toFixed(5)}`}})},()=>{a({text:"Lokatsiyani ulashga ruxsat berilmadi"})},{enableHighAccuracy:!0,timeout:1e4})},J=h=>{const _=h.target.files?.[0]??null;_&&m(_)},p=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),A())},D=h=>{h.preventDefault(),G.current=!1,R.current=!1,f.current&&window.clearTimeout(f.current),f.current=window.setTimeout(()=>{G.current=!0,R.current=!0,I(!0)},550)},L=h=>{h.preventDefault(),f.current&&window.clearTimeout(f.current),G.current||A(),G.current=!1};return e.jsxs("div",{className:"border-t bg-background/80 supports-[backdrop-filter]:bg-background/60 backdrop-blur p-3 sticky bottom-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:j,onChange:J,type:"file",accept:"image/*,video/*",className:"hidden"}),e.jsx("input",{ref:c,onChange:J,type:"file",accept:"audio/*",className:"hidden"}),e.jsx("input",{ref:d,onChange:J,type:"file",accept:"*/*",className:"hidden"}),e.jsxs(Ne,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(O,{type:"button",variant:"secondary",size:"icon",title:"Qo'shish","aria-label":"Qo'shish",className:"shrink-0",children:e.jsx(Sa,{className:"h-4 w-4"})})}),e.jsxs(Se,{align:"start",className:"w-56",children:[e.jsx(H,{onClick:U,children:"Surat/Video tanlash"}),e.jsx(H,{onClick:Y,children:"Audio tanlash"}),e.jsx(H,{onClick:K,children:"Hujjat tanlash"}),e.jsx(ke,{}),e.jsx(H,{onClick:V,children:"Lokatsiya ulash"}),e.jsx(ke,{}),e.jsxs(ra,{children:[e.jsx(oa,{children:"Shablonlar"}),e.jsx(la,{children:y.map(h=>e.jsx(H,{onClick:()=>n(h),children:h},h))})]})]})]}),e.jsx(ne,{className:"flex-1",value:i,onChange:h=>n(h.target.value),onKeyDown:p,placeholder:"Xabar yozing..."}),e.jsx(O,{type:"button",variant:"secondary",size:"icon",onClick:Y,title:"Audio","aria-label":"Audio",className:"shrink-0",children:e.jsx(Na,{className:"h-4 w-4"})}),e.jsxs(Za,{open:b,onOpenChange:h=>{h?R.current&&I(!0):(I(!1),R.current=!1)},children:[e.jsx(Xa,{asChild:!0,children:e.jsx(O,{type:"button",size:"icon",title:"Yuborish","aria-label":"Yuborish",className:"shrink-0",onPointerDown:D,onPointerUp:L,onPointerLeave:()=>{f.current&&window.clearTimeout(f.current),G.current=!1,R.current=!1},children:e.jsx(Aa,{className:"h-4 w-4 text-white"})})}),e.jsx(jt,{align:"end",className:"w-64",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Yuborish vaqtini tanlang"}),e.jsx(pa,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(ne,{type:"datetime-local",value:o,onChange:h=>l(h.target.value)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>l(""),className:"text-xs rounded px-2 py-1 border hover:bg-background",children:"Tozalash"}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:o?new Date(o).toLocaleString():"Darhol"})]})]})})]})]}),o?e.jsxs("div",{className:"mt-2 text-[11px] inline-flex items-center gap-2 rounded border px-2 py-1",children:["Rejalashtirilgan: ",new Date(o).toLocaleString(),e.jsx("button",{onClick:()=>l(""),className:"rounded p-0.5 hover:bg-accent/40","aria-label":"Rejani o'chirish",title:"Rejani o'chirish",children:e.jsx(ue,{className:"h-3 w-3"})})]}):null,r?e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"truncate",children:r.name}),e.jsx("span",{className:"rounded border px-1.5 py-0.5 text-[10px]",children:u}),e.jsxs("button",{onClick:()=>{m(null),w(null),j.current&&(j.current.value=""),c.current&&(c.current.value=""),d.current&&(d.current.value="")},className:"ml-auto inline-flex items-center gap-1 rounded px-1.5 py-0.5 text-[10px] hover:bg-accent/40","aria-label":"Faylni o'chirish",title:"Faylni o'chirish",children:[e.jsx(ue,{className:"h-3 w-3"})," O'chirish"]})]}):null,e.jsx("div",{className:"pt-[env(safe-area-inset-bottom)]"})]})}function Wa({open:a,onClose:i,onSend:n}){const[o,l]=s.useState("");return a?e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40 p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-xl border bg-background p-5 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Mass xabar yuborish"}),e.jsx("textarea",{value:o,onChange:r=>l(r.target.value),className:"w-full min-h-[120px] rounded-md bg-secondary p-3",placeholder:"Xabar matni..."}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[e.jsx(O,{variant:"outline",onClick:i,children:"Bekor qilish"}),e.jsx(O,{onClick:()=>{o.trim()&&(n(o.trim()),l(""),i())},children:"Yuborish"})]})]})}):null}var en="Label",bt=s.forwardRef((a,i)=>e.jsx(Le.label,{...a,ref:i,onMouseDown:n=>{n.target.closest("button, input, select, textarea")||(a.onMouseDown?.(n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));bt.displayName=en;var kt=bt;const tn=ca("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),oe=s.forwardRef(({className:a,...i},n)=>e.jsx(kt,{ref:n,className:z(tn(),a),...i}));oe.displayName=kt.displayName;const an=Jt,nn=Qt,wt=s.forwardRef(({className:a,...i},n)=>e.jsx(et,{ref:n,className:z("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...i}));wt.displayName=et.displayName;const Lt=s.forwardRef(({className:a,children:i,...n},o)=>e.jsxs(nn,{children:[e.jsx(wt,{}),e.jsxs(Xe,{ref:o,className:z("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[i,e.jsxs(Yt,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Lt.displayName=Xe.displayName;const Nt=({className:a,...i})=>e.jsx("div",{className:z("flex flex-col space-y-1.5 text-center sm:text-left",a),...i});Nt.displayName="DialogHeader";const Ct=({className:a,...i})=>e.jsx("div",{className:z("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...i});Ct.displayName="DialogFooter";const St=s.forwardRef(({className:a,...i},n)=>e.jsx(We,{ref:n,className:z("text-lg font-semibold leading-none tracking-tight",a),...i}));St.displayName=We.displayName;const sn=s.forwardRef(({className:a,...i},n)=>e.jsx(tt,{ref:n,className:z("text-sm text-muted-foreground",a),...i}));sn.displayName=tt.displayName;const rn=Zt,on=Xt,Dt=s.forwardRef(({className:a,children:i,...n},o)=>e.jsxs(at,{ref:o,className:z("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...n,children:[i,e.jsx(Wt,{asChild:!0,children:e.jsx(De,{className:"h-4 w-4 opacity-50"})})]}));Dt.displayName=at.displayName;const _t=s.forwardRef(({className:a,...i},n)=>e.jsx(it,{ref:n,className:z("flex cursor-default items-center justify-center py-1",a),...i,children:e.jsx(va,{className:"h-4 w-4"})}));_t.displayName=it.displayName;const Mt=s.forwardRef(({className:a,...i},n)=>e.jsx(rt,{ref:n,className:z("flex cursor-default items-center justify-center py-1",a),...i,children:e.jsx(De,{className:"h-4 w-4"})}));Mt.displayName=rt.displayName;const It=s.forwardRef(({className:a,children:i,position:n="popper",...o},l)=>e.jsx(ea,{children:e.jsxs(nt,{ref:l,className:z("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...o,children:[e.jsx(_t,{}),e.jsx(ta,{className:z("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),e.jsx(Mt,{})]})}));It.displayName=nt.displayName;const ln=s.forwardRef(({className:a,...i},n)=>e.jsx(ot,{ref:n,className:z("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...i}));ln.displayName=ot.displayName;const Pt=s.forwardRef(({className:a,children:i,...n},o)=>e.jsxs(st,{ref:o,className:z("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(aa,{children:e.jsx(xe,{className:"h-4 w-4"})})}),e.jsx(na,{children:i})]}));Pt.displayName=st.displayName;const cn=s.forwardRef(({className:a,...i},n)=>e.jsx(lt,{ref:n,className:z("-mx-1 my-1 h-px bg-muted",a),...i}));cn.displayName=lt.displayName;const he=[{code:"UZ",name:"O'zbekiston",prefix:"+998",mask:"+998 99 999 99 99",minLength:9,maxLength:9},{code:"RU",name:"Rossiya",prefix:"+7",mask:"+7 999 999 99 99",minLength:10,maxLength:10},{code:"KZ",name:"Qozog'iston",prefix:"+7",mask:"+7 999 999 99 99",minLength:10,maxLength:10},{code:"KG",name:"Qirg'iziston",prefix:"+996",mask:"+996 999 999 999",minLength:9,maxLength:9},{code:"TJ",name:"Tojikiston",prefix:"+992",mask:"+992 99 999 9999",minLength:9,maxLength:9},{code:"TM",name:"Turkmaniston",prefix:"+993",mask:"+993 9 999 9999",minLength:8,maxLength:8},{code:"US",name:"United States",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"GB",name:"United Kingdom",prefix:"+44",mask:"+44 9999 999999",minLength:10,maxLength:10},{code:"DE",name:"Germany",prefix:"+49",mask:"+49 999 9999999",minLength:10,maxLength:11},{code:"FR",name:"France",prefix:"+33",mask:"+33 9 99 99 99 99",minLength:9,maxLength:9},{code:"IT",name:"Italy",prefix:"+39",mask:"+39 999 999 9999",minLength:10,maxLength:10},{code:"ES",name:"Spain",prefix:"+34",mask:"+34 999 999 999",minLength:9,maxLength:9},{code:"CN",name:"China",prefix:"+86",mask:"+86 999 9999 9999",minLength:11,maxLength:11},{code:"JP",name:"Japan",prefix:"+81",mask:"+81 99 9999 9999",minLength:10,maxLength:10},{code:"IN",name:"India",prefix:"+91",mask:"+91 99999 99999",minLength:10,maxLength:10},{code:"BR",name:"Brazil",prefix:"+55",mask:"+55 99 99999 9999",minLength:11,maxLength:11},{code:"MX",name:"Mexico",prefix:"+52",mask:"+52 999 999 9999",minLength:10,maxLength:10},{code:"CA",name:"Canada",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"AU",name:"Australia",prefix:"+61",mask:"+61 999 999 999",minLength:9,maxLength:9},{code:"KR",name:"South Korea",prefix:"+82",mask:"+82 99 9999 9999",minLength:10,maxLength:11},{code:"TR",name:"Turkey",prefix:"+90",mask:"+90 999 999 99 99",minLength:10,maxLength:10},{code:"SA",name:"Saudi Arabia",prefix:"+966",mask:"+966 99 999 9999",minLength:9,maxLength:9},{code:"AE",name:"United Arab Emirates",prefix:"+971",mask:"+971 99 999 9999",minLength:9,maxLength:9},{code:"EG",name:"Egypt",prefix:"+20",mask:"+20 999 999 9999",minLength:10,maxLength:10},{code:"ZA",name:"South Africa",prefix:"+27",mask:"+27 99 999 9999",minLength:9,maxLength:9},{code:"NG",name:"Nigeria",prefix:"+234",mask:"+234 999 999 9999",minLength:10,maxLength:11},{code:"KE",name:"Kenya",prefix:"+254",mask:"+254 999 999999",minLength:9,maxLength:9},{code:"GH",name:"Ghana",prefix:"+233",mask:"+233 99 999 9999",minLength:9,maxLength:9},{code:"TZ",name:"Tanzania",prefix:"+255",mask:"+255 999 999 999",minLength:9,maxLength:9},{code:"UG",name:"Uganda",prefix:"+256",mask:"+256 999 999999",minLength:9,maxLength:9},{code:"RW",name:"Rwanda",prefix:"+250",mask:"+250 999 999 999",minLength:9,maxLength:9},{code:"BI",name:"Burundi",prefix:"+257",mask:"+257 99 99 99 99",minLength:8,maxLength:8},{code:"ZM",name:"Zambia",prefix:"+260",mask:"+260 99 9999999",minLength:9,maxLength:9},{code:"ZW",name:"Zimbabwe",prefix:"+263",mask:"+263 99 999 9999",minLength:9,maxLength:9},{code:"MZ",name:"Mozambique",prefix:"+258",mask:"+258 99 999 9999",minLength:9,maxLength:9},{code:"BW",name:"Botswana",prefix:"+267",mask:"+267 99 999 999",minLength:8,maxLength:8},{code:"LS",name:"Lesotho",prefix:"+266",mask:"+266 9 999 9999",minLength:8,maxLength:8},{code:"SZ",name:"Eswatini",prefix:"+268",mask:"+268 99 99 99 99",minLength:8,maxLength:8},{code:"NA",name:"Namibia",prefix:"+264",mask:"+264 99 999 9999",minLength:9,maxLength:9},{code:"AO",name:"Angola",prefix:"+244",mask:"+244 999 999 999",minLength:9,maxLength:9},{code:"CV",name:"Cape Verde",prefix:"+238",mask:"+238 999 99 99",minLength:7,maxLength:7},{code:"GQ",name:"Equatorial Guinea",prefix:"+240",mask:"+240 999 999 999",minLength:9,maxLength:9},{code:"GA",name:"Gabon",prefix:"+241",mask:"+241 9 99 99 99",minLength:7,maxLength:8},{code:"CM",name:"Cameroon",prefix:"+237",mask:"+237 9999 9999",minLength:8,maxLength:8},{code:"TD",name:"Chad",prefix:"+235",mask:"+235 99 99 99 99",minLength:8,maxLength:8},{code:"CF",name:"Central African Republic",prefix:"+236",mask:"+236 99 99 99 99",minLength:8,maxLength:8},{code:"CG",name:"Republic of the Congo",prefix:"+242",mask:"+242 99 999 9999",minLength:9,maxLength:9},{code:"CD",name:"Democratic Republic of the Congo",prefix:"+243",mask:"+243 999 999 999",minLength:9,maxLength:9},{code:"DJ",name:"Djibouti",prefix:"+253",mask:"+253 99 99 99 99",minLength:8,maxLength:8},{code:"ER",name:"Eritrea",prefix:"+291",mask:"+291 9 999 999",minLength:7,maxLength:7},{code:"ET",name:"Ethiopia",prefix:"+251",mask:"+251 99 999 9999",minLength:9,maxLength:9},{code:"SO",name:"Somalia",prefix:"+252",mask:"+252 99 999 9999",minLength:9,maxLength:9},{code:"SS",name:"South Sudan",prefix:"+211",mask:"+211 99 999 9999",minLength:9,maxLength:9},{code:"SD",name:"Sudan",prefix:"+249",mask:"+249 99 999 9999",minLength:9,maxLength:9},{code:"MA",name:"Morocco",prefix:"+212",mask:"+212 999 999999",minLength:9,maxLength:9},{code:"TN",name:"Tunisia",prefix:"+216",mask:"+216 99 999 999",minLength:8,maxLength:8},{code:"LY",name:"Libya",prefix:"+218",mask:"+218 99 999 9999",minLength:9,maxLength:10},{code:"DZ",name:"Algeria",prefix:"+213",mask:"+213 999 999 999",minLength:9,maxLength:9},{code:"MR",name:"Mauritania",prefix:"+222",mask:"+222 99 99 99 99",minLength:8,maxLength:8},{code:"ML",name:"Mali",prefix:"+223",mask:"+223 99 99 99 99",minLength:8,maxLength:8},{code:"SN",name:"Senegal",prefix:"+221",mask:"+221 99 999 9999",minLength:9,maxLength:9},{code:"GM",name:"Gambia",prefix:"+220",mask:"+220 999 9999",minLength:7,maxLength:7},{code:"GN",name:"Guinea",prefix:"+224",mask:"+224 999 999 999",minLength:9,maxLength:9},{code:"SL",name:"Sierra Leone",prefix:"+232",mask:"+232 99 999999",minLength:8,maxLength:8},{code:"LR",name:"Liberia",prefix:"+231",mask:"+231 99 999 9999",minLength:9,maxLength:10},{code:"CI",name:"Ivory Coast",prefix:"+225",mask:"+225 99 999 999",minLength:8,maxLength:8},{code:"BF",name:"Burkina Faso",prefix:"+226",mask:"+226 99 99 99 99",minLength:8,maxLength:8},{code:"TG",name:"Togo",prefix:"+228",mask:"+228 99 99 99 99",minLength:8,maxLength:8},{code:"BJ",name:"Benin",prefix:"+229",mask:"+229 99 99 99 99",minLength:8,maxLength:8},{code:"NE",name:"Niger",prefix:"+227",mask:"+227 99 99 99 99",minLength:8,maxLength:8},{code:"HT",name:"Haiti",prefix:"+509",mask:"+509 99 99 9999",minLength:8,maxLength:8},{code:"DO",name:"Dominican Republic",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"CU",name:"Cuba",prefix:"+53",mask:"+53 9 999 9999",minLength:8,maxLength:8},{code:"JM",name:"Jamaica",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"TT",name:"Trinidad and Tobago",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"BB",name:"Barbados",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"BS",name:"Bahamas",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"AG",name:"Antigua and Barbuda",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"VC",name:"Saint Vincent and the Grenadines",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"GD",name:"Grenada",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"DM",name:"Dominica",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"KN",name:"Saint Kitts and Nevis",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"LC",name:"Saint Lucia",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"MS",name:"Montserrat",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"TC",name:"Turks and Caicos Islands",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"VG",name:"British Virgin Islands",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"VI",name:"U.S. Virgin Islands",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"PR",name:"Puerto Rico",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"AS",name:"American Samoa",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"GU",name:"Guam",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"MP",name:"Northern Mariana Islands",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"KY",name:"Cayman Islands",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"BM",name:"Bermuda",prefix:"+1",mask:"+1 999 999 9999",minLength:10,maxLength:10},{code:"FK",name:"Falkland Islands",prefix:"+500",mask:"+500 99999",minLength:5,maxLength:5},{code:"GS",name:"South Georgia and the South Sandwich Islands",prefix:"+500",mask:"+500 99999",minLength:5,maxLength:5},{code:"SH",name:"Saint Helena",prefix:"+290",mask:"+290 9999",minLength:4,maxLength:4},{code:"TA",name:"Tristan da Cunha",prefix:"+290",mask:"+290 9999",minLength:4,maxLength:4},{code:"AC",name:"Ascension Island",prefix:"+247",mask:"+247 9999",minLength:4,maxLength:4},{code:"IO",name:"British Indian Ocean Territory",prefix:"+246",mask:"+246 999 9999",minLength:7,maxLength:7},{code:"CX",name:"Christmas Island",prefix:"+61",mask:"+61 999 999 999",minLength:9,maxLength:9},{code:"CC",name:"Cocos (Keeling) Islands",prefix:"+61",mask:"+61 999 999 999",minLength:9,maxLength:9},{code:"NF",name:"Norfolk Island",prefix:"+672",mask:"+672 9 99999",minLength:6,maxLength:6},{code:"HM",name:"Heard Island and McDonald Islands",prefix:"+672",mask:"+672 9 99999",minLength:6,maxLength:6},{code:"AQ",name:"Antarctica",prefix:"+672",mask:"+672 9 99999",minLength:6,maxLength:6},{code:"BV",name:"Bouvet Island",prefix:"+47",mask:"+47 999 99 999",minLength:8,maxLength:8},{code:"SJ",name:"Svalbard and Jan Mayen",prefix:"+47",mask:"+47 999 99 999",minLength:8,maxLength:8},{code:"TF",name:"French Southern Territories",prefix:"+262",mask:"+262 999 99 99 99",minLength:9,maxLength:9},{code:"PF",name:"French Polynesia",prefix:"+689",mask:"+689 99 99 99 99",minLength:8,maxLength:8},{code:"NC",name:"New Caledonia",prefix:"+687",mask:"+687 99 99 99",minLength:6,maxLength:6},{code:"WF",name:"Wallis and Futuna",prefix:"+681",mask:"+681 99 99 99",minLength:6,maxLength:6},{code:"YT",name:"Mayotte",prefix:"+262",mask:"+262 999 99 99 99",minLength:9,maxLength:9},{code:"RE",name:"Runion",prefix:"+262",mask:"+262 999 99 99 99",minLength:9,maxLength:9},{code:"PM",name:"Saint Pierre and Miquelon",prefix:"+508",mask:"+508 99 99 99",minLength:6,maxLength:6},{code:"BL",name:"Saint Barthlemy",prefix:"+590",mask:"+590 999 99 99 99",minLength:9,maxLength:9},{code:"MF",name:"Saint Martin",prefix:"+590",mask:"+590 999 99 99 99",minLength:9,maxLength:9},{code:"GP",name:"Guadeloupe",prefix:"+590",mask:"+590 999 99 99 99",minLength:9,maxLength:9},{code:"MQ",name:"Martinique",prefix:"+596",mask:"+596 999 99 99 99",minLength:9,maxLength:9},{code:"GF",name:"French Guiana",prefix:"+594",mask:"+594 999 99 99 99",minLength:9,maxLength:9},{code:"AX",name:"land Islands",prefix:"+358",mask:"+358 999 999999",minLength:9,maxLength:11},{code:"FI",name:"Finland",prefix:"+358",mask:"+358 999 999999",minLength:9,maxLength:11},{code:"EE",name:"Estonia",prefix:"+372",mask:"+372 9999 9999",minLength:8,maxLength:8},{code:"LV",name:"Latvia",prefix:"+371",mask:"+371 99 999 999",minLength:8,maxLength:8},{code:"LT",name:"Lithuania",prefix:"+370",mask:"+370 999 99 999",minLength:8,maxLength:8},{code:"BY",name:"Belarus",prefix:"+375",mask:"+375 99 999 99 99",minLength:9,maxLength:9},{code:"UA",name:"Ukraine",prefix:"+380",mask:"+380 99 999 99 99",minLength:9,maxLength:9},{code:"MD",name:"Moldova",prefix:"+373",mask:"+373 999 99 999",minLength:8,maxLength:8},{code:"RO",name:"Romania",prefix:"+40",mask:"+40 999 999 999",minLength:9,maxLength:10},{code:"BG",name:"Bulgaria",prefix:"+359",mask:"+359 999 999 999",minLength:9,maxLength:9},{code:"GR",name:"Greece",prefix:"+30",mask:"+30 999 999 9999",minLength:10,maxLength:10},{code:"CY",name:"Cyprus",prefix:"+357",mask:"+357 99 999999",minLength:8,maxLength:8},{code:"MT",name:"Malta",prefix:"+356",mask:"+356 9999 9999",minLength:8,maxLength:8},{code:"SI",name:"Slovenia",prefix:"+386",mask:"+386 99 999 999",minLength:8,maxLength:9},{code:"HR",name:"Croatia",prefix:"+385",mask:"+385 99 999 9999",minLength:9,maxLength:9},{code:"BA",name:"Bosnia and Herzegovina",prefix:"+387",mask:"+387 99 999 999",minLength:8,maxLength:9},{code:"ME",name:"Montenegro",prefix:"+382",mask:"+382 99 999 999",minLength:8,maxLength:9},{code:"RS",name:"Serbia",prefix:"+381",mask:"+381 99 999 9999",minLength:9,maxLength:10},{code:"MK",name:"North Macedonia",prefix:"+389",mask:"+389 99 999 999",minLength:8,maxLength:8},{code:"AL",name:"Albania",prefix:"+355",mask:"+355 99 999 9999",minLength:9,maxLength:9},{code:"XK",name:"Kosovo",prefix:"+383",mask:"+383 99 999 999",minLength:8,maxLength:9},{code:"PT",name:"Portugal",prefix:"+351",mask:"+351 999 999 999",minLength:9,maxLength:9},{code:"AD",name:"Andorra",prefix:"+376",mask:"+376 999 999",minLength:6,maxLength:6},{code:"MC",name:"Monaco",prefix:"+377",mask:"+377 99 99 99 99",minLength:8,maxLength:8},{code:"SM",name:"San Marino",prefix:"+378",mask:"+378 9999 999999",minLength:10,maxLength:10},{code:"VA",name:"Vatican City",prefix:"+379",mask:"+379 999 999999",minLength:9,maxLength:9},{code:"LI",name:"Liechtenstein",prefix:"+423",mask:"+423 999 999 999",minLength:9,maxLength:9},{code:"CH",name:"Switzerland",prefix:"+41",mask:"+41 99 999 99 99",minLength:9,maxLength:9},{code:"AT",name:"Austria",prefix:"+43",mask:"+43 999 9999999",minLength:10,maxLength:13},{code:"SK",name:"Slovakia",prefix:"+421",mask:"+421 999 999 999",minLength:9,maxLength:9},{code:"CZ",name:"Czech Republic",prefix:"+420",mask:"+420 999 999 999",minLength:9,maxLength:9},{code:"PL",name:"Poland",prefix:"+48",mask:"+48 999 999 999",minLength:9,maxLength:9},{code:"HU",name:"Hungary",prefix:"+36",mask:"+36 99 999 9999",minLength:9,maxLength:9},{code:"NO",name:"Norway",prefix:"+47",mask:"+47 999 99 999",minLength:8,maxLength:8},{code:"SE",name:"Sweden",prefix:"+46",mask:"+46 99 999 9999",minLength:9,maxLength:10},{code:"DK",name:"Denmark",prefix:"+45",mask:"+45 99 99 99 99",minLength:8,maxLength:8},{code:"IS",name:"Iceland",prefix:"+354",mask:"+354 999 9999",minLength:7,maxLength:7},{code:"IE",name:"Ireland",prefix:"+353",mask:"+353 99 999 9999",minLength:9,maxLength:9},{code:"NL",name:"Netherlands",prefix:"+31",mask:"+31 99 9999999",minLength:9,maxLength:10},{code:"BE",name:"Belgium",prefix:"+32",mask:"+32 999 99 99 99",minLength:8,maxLength:9},{code:"LU",name:"Luxembourg",prefix:"+352",mask:"+352 999 999 999",minLength:9,maxLength:9},{code:"GI",name:"Gibraltar",prefix:"+350",mask:"+350 99999",minLength:5,maxLength:5},{code:"FO",name:"Faroe Islands",prefix:"+298",mask:"+298 999999",minLength:6,maxLength:6},{code:"GL",name:"Greenland",prefix:"+299",mask:"+299 99 99 99",minLength:6,maxLength:6},{code:"IM",name:"Isle of Man",prefix:"+44",mask:"+44 9999 999999",minLength:10,maxLength:10},{code:"JE",name:"Jersey",prefix:"+44",mask:"+44 9999 999999",minLength:10,maxLength:10},{code:"GG",name:"Guernsey",prefix:"+44",mask:"+44 9999 999999",minLength:10,maxLength:10}],je="https://talkapp.up.railway.app";function dn({open:a,onClose:i,onSuccess:n}){const{user:o}=ie(),[l,r]=s.useState("phone"),[m,u]=s.useState(!1),w=he.find(p=>p.code==="UZ")||null,[y,j]=s.useState(w),[c,d]=s.useState(w?.prefix||""),[b,I]=s.useState(""),[f,G]=s.useState(""),[R,g]=s.useState(null),A=async()=>{if(l==="phone"&&c.trim()){u(!0);try{const{data:{session:p}}=await ve(async()=>{const{createClient:h}=await import("./index-DGb-t3le.js").then(_=>_.r);return{createClient:h}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({createClient:h})=>h("https://kqgjxxnnhcdcvpkkpvwi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxZ2p4eG5uaGNkY3Zwa2twdndpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2NTg1NDIsImV4cCI6MjA3MzIzNDU0Mn0.tvOmGyKN4bKncK_xrUxUZwseDDRrQH0RMrGvb581h8M").auth.getSession());if(!p?.access_token){console.error("No access token available"),u(!1);return}const L=await(await fetch(`${je}/start_login`,{method:"POST",headers:{Authorization:`Bearer ${p.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({phone_number:c.replace(/\s/g,"")})})).json();L.ok?(g(L),r("verify")):console.error("Login failed:",L.message)}catch(p){console.error("API call failed:",p)}finally{u(!1)}}else if(l==="verify"&&b.trim()&&R){u(!0);try{const{data:{session:p}}=await ve(async()=>{const{createClient:h}=await import("./index-DGb-t3le.js").then(_=>_.r);return{createClient:h}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({createClient:h})=>h("https://kqgjxxnnhcdcvpkkpvwi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxZ2p4eG5uaGNkY3Zwa2twdndpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2NTg1NDIsImV4cCI6MjA3MzIzNDU0Mn0.tvOmGyKN4bKncK_xrUxUZwseDDRrQH0RMrGvb581h8M").auth.getSession());if(!p?.access_token){console.error("No access token available"),u(!1);return}const L=await(await fetch(`${je}/verify_code`,{method:"POST",headers:{Authorization:`Bearer ${p.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({phone_number:c.replace(/\s/g,""),code:b.trim()})})).json();L.ok&&L.status==="LOGGED_IN"?(n({...L,phone:c.replace(/\s/g,""),country:y}),U()):L.status==="PASSWORD_REQUIRED"?(g(L),r("password")):console.error("Verification failed:",L.message)}catch(p){console.error("Verification API call failed:",p)}finally{u(!1)}}else if(l==="password"&&f.trim()&&R){u(!0);try{const{data:{session:p}}=await ve(async()=>{const{createClient:h}=await import("./index-DGb-t3le.js").then(_=>_.r);return{createClient:h}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({createClient:h})=>h("https://kqgjxxnnhcdcvpkkpvwi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxZ2p4eG5uaGNkY3Zwa2twdndpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2NTg1NDIsImV4cCI6MjA3MzIzNDU0Mn0.tvOmGyKN4bKncK_xrUxUZwseDDRrQH0RMrGvb581h8M").auth.getSession());if(!p?.access_token){console.error("No access token available"),u(!1);return}const L=await(await fetch(`${je}/verify_password`,{method:"POST",headers:{Authorization:`Bearer ${p.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({phone_number:c.replace(/\s/g,""),password:f.trim()})})).json();L.ok&&L.status==="LOGGED_IN"?(n({...L,phone:c.replace(/\s/g,""),country:y}),U()):console.error("Password verification failed:",L.message)}catch(p){console.error("Password verification API call failed:",p)}finally{u(!1)}}},U=()=>{r("phone"),j(w),d(w?.prefix||""),I(""),G(""),g(null),u(!1),i()},Y=()=>{r("phone"),I("")},K=p=>{const D=he.find(L=>L.code===p);if(j(D||null),D)if(!c||c==="+")d(D.prefix);else{const L=V(c,D);d(L)}},V=(p,D)=>{if(!D)return p;const L=p.replace(/\D/g,""),h=D.prefix.replace("+","");if(!L.startsWith(h))return p;const _=L.slice(h.length),E=D.mask,Q=E.indexOf(D.prefix)+D.prefix.length,N=E.slice(Q);let S=D.prefix,T=0;for(let M=0;M<N.length&&T<_.length;M++){const B=N[M];B==="9"?(S+=_[T],T++):S+=B}return S},J=p=>{let D=null;p.startsWith("+")&&(D=he.find(h=>p.startsWith(h.prefix))),D&&D!==y?j(D):!D&&y&&!p.startsWith(y.prefix)&&j(null);const L=D||y;if(L){const h=V(p,L);d(h)}else d(p)};return e.jsx(an,{open:a,onOpenChange:U,children:e.jsxs(Lt,{className:"sm:max-w-[425px]",children:[e.jsx(Nt,{children:e.jsx(St,{children:l==="phone"?"Hisob qo'shish":l==="verify"?"Kodni tasdiqlash":"Parolni kiriting"})}),e.jsx("div",{className:"grid gap-4 py-4",children:l==="phone"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(oe,{htmlFor:"country",children:"Davlatni tanlang"}),e.jsxs(rn,{value:y?.code||"",onValueChange:K,children:[e.jsx(Dt,{children:e.jsx(on,{placeholder:"Davlatni tanlang"})}),e.jsx(It,{children:he.map(p=>e.jsxs(Pt,{value:p.code,children:[p.name," (",p.prefix,")"]},p.code))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(oe,{htmlFor:"phone",children:"Telefon raqami"}),e.jsx(ne,{id:"phone",type:"tel",placeholder:"+998 00 000 00 00",value:c,onChange:p=>J(p.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Telefon raqamingizni kiriting"})]})]}):l==="verify"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(oe,{htmlFor:"code",children:"Tasdiqlash kodi"}),e.jsx(ne,{id:"code",type:"text",placeholder:"12345",value:b,onChange:p=>I(p.target.value),maxLength:6}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[c," raqamiga yuborilgan kodni kiriting"]})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(oe,{htmlFor:"password",children:"Parol"}),e.jsx(ne,{id:"password",type:"password",placeholder:"Parolingizni kiriting",value:f,onChange:p=>G(p.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ikkinchi bosqichli parolni kiriting"})]})})}),e.jsxs(Ct,{children:[e.jsx(O,{variant:"outline",onClick:l==="phone"?U:Y,children:l==="phone"?"Bekor qilish":"Orqaga"}),e.jsx(O,{onClick:A,disabled:l==="phone"&&!c.trim()||l==="verify"&&!b.trim()||l==="password"&&!f.trim()||m,className:"text-white",children:m?"Yuborilmoqda...":l==="phone"?"Davam etish":l==="verify"?"Tasdiqlash":"Kirish"})]})]})})}function mn({open:a,onClose:i}){const{user:n,switchTelegramAccount:o,logoutTelegramAccount:l}=ie(),{toast:r}=da();return!a||!n?null:e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40 p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-xl border bg-background p-5 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Telegram hisoblari"}),e.jsx("div",{className:"space-y-2",children:n.telegramAccounts.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Hisob topilmadi."}):n.telegramAccounts.map(m=>e.jsxs("div",{className:"flex items-center justify-between border rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m.profile_picture?e.jsx("img",{src:m.profile_picture,alt:m.name,className:"h-10 w-10 rounded-full object-cover"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary text-white grid place-items-center font-semibold",children:m.name.split(" ").map(u=>u[0]).slice(0,2).join("")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:m.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:m.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(m.id),className:"px-2 py-1 rounded bg-secondary text-sm",children:"Faollashtirish"}),e.jsx("button",{onClick:async()=>{try{await l(m.id),r({title:"Hisob chiqarildi",description:`${m.name} hisobi muvaffaqiyatli chiqarildi.`})}catch{r({title:"Xatolik",description:"Hisobni chiqarishda xatolik yuz berdi.",variant:"destructive"})}},className:"px-2 py-1 rounded bg-red-500 text-white text-sm hover:bg-red-600",children:"Chiqish"})]})]},m.id))}),e.jsx("div",{className:"mt-4 flex justify-end gap-2",children:e.jsx(O,{variant:"outline",onClick:i,children:"Yopish"})})]})})}function hn({open:a,onClose:i}){const{user:n,updateUser:o}=ie(),[l,r]=s.useState([]),[m,u]=s.useState("");s.useEffect(()=>{if(!n)return;const y=`tt_templates_${n.email}`,j=localStorage.getItem(y);r(j?JSON.parse(j):["Salom! Sizga qanday yordam bera olaman?","Rahmat! Tez orada aloqaga chiqamiz."])},[n]);const w=y=>{if(!n)return;const j=`tt_templates_${n.email}`;localStorage.setItem(j,JSON.stringify(y)),r(y)};return!a||!n?null:e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40 p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-xl border bg-background p-5 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Xabar shablonlari"}),e.jsx("div",{className:"space-y-2 mb-3",children:l.map((y,j)=>e.jsxs("div",{className:"flex items-center justify-between border rounded p-2",children:[e.jsx("div",{className:"text-sm",children:y}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>{const c=l.filter((d,b)=>b!==j);w(c)},className:"px-2 py-1 rounded bg-destructive text-destructive-foreground",children:"O'chirish"})})]},j))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:m,onChange:y=>u(y.target.value),placeholder:"Yangi shablon...",className:"flex-1 rounded-md bg-secondary px-3 py-2"}),e.jsx(O,{onClick:()=>{if(!m.trim())return;const y=[...l,m.trim()];w(y),u("")},children:"Qo'shish"})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(O,{variant:"outline",onClick:i,children:"Yopish"})})]})})}function xn({open:a,onClose:i}){const{user:n,updateUser:o,addToBlocklist:l,removeFromBlocklist:r}=ie(),[m,u]=s.useState(()=>({aiForGroups:n?.settings?.aiForGroups??!1,aiForPrivate:n?.settings?.aiForPrivate??!1})),[w,y]=s.useState("");if(!a||!n)return null;const j=()=>{o(c=>({...c,settings:{aiForGroups:m.aiForGroups,aiForPrivate:m.aiForPrivate}})),i()};return e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40 p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-xl border bg-background p-5 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sozlamalar"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"AI avtomatik javob (Guruhlar)"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Guruhlarda AI avtojavobni yoqish/ochirish"})]}),e.jsx("label",{className:"inline-flex items-center gap-2",children:e.jsx("input",{type:"checkbox",checked:m.aiForGroups,onChange:c=>u(d=>({...d,aiForGroups:c.target.checked}))})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"AI avtomatik javob (Shaxsiy)"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Shaxsiy chatlar uchun AI-avtojavobni yoqish/ochirish"})]}),e.jsx("label",{className:"inline-flex items-center gap-2",children:e.jsx("input",{type:"checkbox",checked:m.aiForPrivate,onChange:c=>u(d=>({...d,aiForPrivate:c.target.checked}))})})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"font-medium mb-1",children:"Mass xabar blocklist"}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:"Bu royxatdagi shaxsiy chat foydalanuvchilariga mass xabar yuborilmaydi."}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{value:w,onChange:c=>y(c.target.value),placeholder:"Foydalanuvchi nomi",className:"flex-1 rounded-md bg-secondary px-3 py-2 text-sm"}),e.jsx(O,{onClick:()=>{const c=w.trim();c&&(l(c),y(""))},children:"Qoshish"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(n.blocklist??[]).length===0?e.jsx("div",{className:"text-xs text-muted-foreground",children:"Royxat bosh."}):(n.blocklist??[]).map(c=>e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs",children:[c,e.jsx("button",{onClick:()=>r(c),className:"text-muted-foreground hover:text-foreground","aria-label":`Olib tashlash: ${c}`,children:""})]},c))})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(O,{variant:"outline",onClick:i,children:"Bekor"}),e.jsx(O,{onClick:j,children:"Saqlash"})]})]})})}const be=768;function un(){const[a,i]=s.useState(void 0);return s.useEffect(()=>{const n=window.matchMedia(`(max-width: ${be-1}px)`),o=()=>{i(window.innerWidth<be)};return n.addEventListener("change",o),i(window.innerWidth<be),()=>n.removeEventListener("change",o)},[]),!!a}function Cn(){const{user:a,switchTelegramAccount:i}=ie(),n=un(),[o,l]=s.useState(!1),[r,m]=s.useState(!1),[u,w]=s.useState(!1),[y,j]=s.useState(!1),[c,d]=s.useState(!1),[b,I]=s.useState(()=>{try{return localStorage.getItem("tt_chat_sidebar_collapsed")==="1"}catch{return!1}}),f=a?.telegramAccounts.find(v=>v.id===a.activeTelegramAccountId)??a?.telegramAccounts[0]??null,[G,R]=s.useState([]),[g,A]=s.useState([]),[U,Y]=s.useState([]),[K,V]=s.useState(!1),[J,p]=s.useState(!1),[D,L]=s.useState(!1),[h,_]=s.useState("private");s.useEffect(()=>{(async()=>{if(f?.index){V(!0);try{const C=await me.fetchPrivateChats(f.index);if(C.ok){const P="https://talkapp.up.railway.app",F=C.items.map(x=>({id:x.id.toString(),name:x.full_name||x.username||"Deleted Account",type:"private",avatar:!x.full_name&&!x.username?"deleted":x.has_photo?`${P}${x.photo_url}`:void 0}));R(F)}}catch(C){console.error("Failed to fetch private chats",C)}finally{V(!1)}}})()},[f?.index]),s.useEffect(()=>{(async()=>{if(!(!f?.index||h!=="group")){p(!0);try{const C=await me.fetchGroups(f.index);if(C.ok){const P="https://talkapp.up.railway.app",F=C.items.map(x=>({id:x.id.toString(),name:x.title,type:"group",avatar:x.has_photo?`${P}${x.photo_url}`:void 0}));A(F),Y(C.items)}}catch(C){console.error("Failed to fetch groups",C)}finally{p(!1)}}})()},[f?.index,h,g.length]),s.useEffect(()=>{try{localStorage.setItem("tt_chat_sidebar_collapsed",b?"1":"0")}catch{}},[b]);const E=s.useMemo(()=>[...G,...g],[G,g]),[Q,N]=s.useState({1:[{id:"m1",sender:"them",text:"Salom! Yordam bera olamanmi?",at:Date.now()-6e5},{id:"m2",sender:"me",text:"Assalomu alaykum! Ha, hisob ulashmoqchi edim.",at:Date.now()-57e4},{id:"m3",sender:"them",text:"Qaysi hisob haqida gapiryapsiz?",at:Date.now()-54e4},{id:"m4",sender:"me",text:"Telegram hisobim haqida. Yangi loyihamiz uchun.",at:Date.now()-51e4},{id:"m5",sender:"them",text:"Tushundim. Ma'lumotlaringizni yuboring.",at:Date.now()-48e4},{id:"m6",sender:"me",text:"Albatta, hoziroq yuboraman.",at:Date.now()-45e4},{id:"m7",sender:"them",text:"Rahmat. Ko'rib chiqaman.",at:Date.now()-3e4}],2:[{id:"m8",sender:"them",text:"Qanday yordam kerak?",at:Date.now()-72e4},{id:"m9",sender:"me",text:"Mahsulot haqida ma'lumot beraman.",at:Date.now()-69e4},{id:"m10",sender:"them",text:"Qaysi mahsulot?",at:Date.now()-66e4},{id:"m11",sender:"me",text:"Yangi smartfon modelimiz.",at:Date.now()-63e4},{id:"m12",sender:"them",text:"Narxi qancha?",at:Date.now()-6e5},{id:"m13",sender:"me",text:"2 million so'mdan boshlanadi.",at:Date.now()-57e4},{id:"m14",sender:"them",text:"Qiziqarli. Ko'proq ma'lumot bering.",at:Date.now()-12e4}],3:[{id:"m15",sender:"them",text:"Loyiha qachon tugaydi?",at:Date.now()-9e5},{id:"m16",sender:"me",text:"Keyingi oy oxirida.",at:Date.now()-87e4},{id:"m17",sender:"them",text:"Jadvalga rioya qilamizmi?",at:Date.now()-84e4},{id:"m18",sender:"me",text:"Ha, barcha vazifalar bajarildi.",at:Date.now()-81e4},{id:"m19",sender:"them",text:"Ajoyib! Mijozga xabar beraman.",at:Date.now()-18e4}],4:[{id:"m20",sender:"them",text:"Texnik yordam kerak.",at:Date.now()-108e4},{id:"m21",sender:"me",text:"Qanday muammo bor?",at:Date.now()-105e4},{id:"m22",sender:"them",text:"Kompyuter sekin ishlayapti.",at:Date.now()-102e4},{id:"m23",sender:"me",text:"Qaysi operatsion sistema?",at:Date.now()-99e4},{id:"m24",sender:"them",text:"Windows 10.",at:Date.now()-96e4},{id:"m25",sender:"me",text:"Diagnostika qilaman. Kuting.",at:Date.now()-24e4}],5:[{id:"m26",sender:"user1",text:"Yangi kampaniya boshlandi!",at:Date.now()-12e5},{id:"m27",sender:"user2",text:"Ajoyib! Qanday natija kutmoqdamiz?",at:Date.now()-117e4},{id:"m28",sender:"me",text:"Kampaniya muvaffaqiyatli bo'lsin!",at:Date.now()-114e4},{id:"m29",sender:"user3",text:"Men ham qo'shilaman!",at:Date.now()-111e4},{id:"m30",sender:"user4",text:"Byudjet qancha?",at:Date.now()-108e4},{id:"m31",sender:"me",text:"5 million so'm ajratildi.",at:Date.now()-105e4},{id:"m32",sender:"user1",text:"Yaxshi, boshladik!",at:Date.now()-3e5}],6:[{id:"m33",sender:"user3",text:"Savdo ko'rsatkichlari yaxshi.",at:Date.now()-132e4},{id:"m34",sender:"me",text:"Qaysi oy uchun?",at:Date.now()-129e4},{id:"m35",sender:"user3",text:"O'tgan oy.",at:Date.now()-126e4},{id:"m36",sender:"me",text:"Foiz qancha o'sish bor?",at:Date.now()-123e4},{id:"m37",sender:"user3",text:"15% o'sish.",at:Date.now()-36e4}],7:[{id:"m38",sender:"them",text:"Salom do'stim!",at:Date.now()-144e4},{id:"m39",sender:"me",text:"Salom! Qandaysan?",at:Date.now()-141e4},{id:"m40",sender:"them",text:"Yaxshi, rahmat. Sen-chi?",at:Date.now()-138e4},{id:"m41",sender:"me",text:"Men ham yaxshi. Ishlar qalay?",at:Date.now()-42e4}],8:[{id:"m42",sender:"them",text:"Yordam bera olasizmi?",at:Date.now()-156e4},{id:"m43",sender:"me",text:"Albatta, nima yordam kerak?",at:Date.now()-153e4},{id:"m44",sender:"them",text:"Darsda tushunmaganman.",at:Date.now()-15e5},{id:"m45",sender:"me",text:"Qaysi mavzu?",at:Date.now()-147e4},{id:"m46",sender:"them",text:"Matematika.",at:Date.now()-48e4}],9:[{id:"m47",sender:"them",text:"Loyiha muhokamasi.",at:Date.now()-168e4},{id:"m48",sender:"me",text:"Qachon uchrashamiz?",at:Date.now()-165e4},{id:"m49",sender:"them",text:"Ertaga soat 10:00 da.",at:Date.now()-162e4},{id:"m50",sender:"me",text:"Yaxshi, kelaman.",at:Date.now()-54e4}],10:[{id:"m51",sender:"them",text:"Tadbir haqida gaplashaylik.",at:Date.now()-18e5},{id:"m52",sender:"me",text:"Qaysi tadbir?",at:Date.now()-177e4},{id:"m53",sender:"them",text:"Kompaniya yubileyi.",at:Date.now()-174e4},{id:"m54",sender:"me",text:"Qachon bo'ladi?",at:Date.now()-171e4},{id:"m55",sender:"them",text:"Keyingi oy.",at:Date.now()-6e5}],11:[{id:"m56",sender:"them",text:"Yangi loyiha taklifi.",at:Date.now()-192e4},{id:"m57",sender:"me",text:"Qanday loyiha?",at:Date.now()-189e4},{id:"m58",sender:"them",text:"Mobil ilova.",at:Date.now()-186e4},{id:"m59",sender:"me",text:"Qiziq. Batafsil aytib bering.",at:Date.now()-66e4}],12:[{id:"m60",sender:"them",text:"Uchrashuv belgilaylik.",at:Date.now()-204e4},{id:"m61",sender:"me",text:"Qachon qulay?",at:Date.now()-201e4},{id:"m62",sender:"them",text:"Bugun kechqurun.",at:Date.now()-198e4},{id:"m63",sender:"me",text:"Soat 18:00 da bo'ladi.",at:Date.now()-72e4}],13:[{id:"m64",sender:"user4",text:"Frontend kod review qilindi.",at:Date.now()-216e4},{id:"m65",sender:"user5",text:"Yaxshi ish! Bug'lar tuzatildi.",at:Date.now()-213e4},{id:"m66",sender:"me",text:"Rahmat jamoa!",at:Date.now()-21e5},{id:"m67",sender:"user6",text:"Testlar o'tkazildi.",at:Date.now()-207e4},{id:"m68",sender:"user4",text:"Deployment tayyor.",at:Date.now()-204e4},{id:"m69",sender:"me",text:"Ajoyib! Deploy qilamiz.",at:Date.now()-78e4}],14:[{id:"m70",sender:"user6",text:"Mijoz shikoyati kelib tushdi.",at:Date.now()-228e4},{id:"m71",sender:"me",text:"Qanday shikoyat?",at:Date.now()-225e4},{id:"m72",sender:"user6",text:"Yetkazib berish kechikdi.",at:Date.now()-222e4},{id:"m73",sender:"me",text:"Mijozga uzr so'raymiz.",at:Date.now()-219e4},{id:"m74",sender:"user6",text:"Yaxshi, men hal qilaman.",at:Date.now()-84e4}],15:[{id:"m75",sender:"user7",text:"Oilaviy uchrashuv rejalashtirildi.",at:Date.now()-24e5},{id:"m76",sender:"me",text:"Qachon?",at:Date.now()-237e4},{id:"m77",sender:"user7",text:"Shanba kuni.",at:Date.now()-234e4},{id:"m78",sender:"me",text:"Barcha keladimi?",at:Date.now()-231e4},{id:"m79",sender:"user7",text:"Ha, hamma keladi.",at:Date.now()-9e5}]}),[S,T]=s.useState({}),[M,B]=s.useState({}),[$,ee]=s.useState({}),[te,re]=s.useState({}),[t,Z]=s.useState(null);s.useEffect(()=>{(async()=>{if(!(!t||!f?.index)){L(!0);try{const C=await me.fetchChatMessages(t,f.index,0);if(C.ok){const P="https://talkapp.up.railway.app",F=C.messages.map(x=>{const k=x.from_user.id===parseInt(f.id)?"me":x.from_user.first_name||"them",ae=x.text||x.caption||"",fe=new Date(x.date).getTime();let de;return x.media_type&&(de={type:{photo:"image",video:"video",video_note:"video_note",audio:"audio",document:"document",location:"location",contact:"contact"}[x.media_type]||"document",url:x.file_url?`${P}${x.file_url}`:x.file_id?`${P}${x.file_id}`:"",name:x.file_name||void 0,mime_type:x.mime_type||void 0}),{id:x.id.toString(),sender:k,text:ae,at:fe,file:de,is_read:x.is_read,is_outgoing:x.is_outgoing,userPhoto:x.from_user.photo_url?`${P}${x.from_user.photo_url}`:void 0,chatType:x.chat_type}}).reverse();N(x=>({...x,[t]:F})),T(x=>({...x,[t]:0})),ee(x=>({...x,[t]:C.count})),re(x=>({...x,[t]:C.messages.length===10}))}}catch(C){console.error("Failed to fetch messages",C)}finally{L(!1)}}})()},[t,f?.index]),s.useEffect(()=>{!n&&!t&&Z(E[0]?.id??null)},[n,E]);const Me=async()=>{if(!t||!f?.index||M[t])return;B(P=>({...P,[t]:!0}));const C=(S[t]||0)+10;try{const P=await me.fetchChatMessages(t,f?.index||"1",C);if(P.ok){const F="https://talkapp.up.railway.app",x=P.messages.map(k=>{const ae=k.from_user.id===parseInt(f.id)?"me":k.from_user.first_name||"them",fe=k.text||k.caption||"",de=new Date(k.date).getTime();let ge;return k.media_type&&(ge={type:{photo:"image",video:"video",video_note:"video",audio:"audio",document:"document",location:"location",contact:"contact"}[k.media_type]||"document",url:k.file_id||"",name:k.file_name||void 0,mime_type:k.mime_type||void 0}),{id:k.id.toString(),sender:ae,text:fe,at:de,file:ge,is_read:k.is_read,is_outgoing:k.is_outgoing,userPhoto:k.from_user.photo_url?`${F}${k.from_user.photo_url}`:void 0,chatType:k.chat_type}}).reverse();x.length>0&&(N(k=>({...k,[t]:[...x,...k[t]||[]]})),T(k=>({...k,[t]:C})),re(k=>({...k,[t]:x.length===10})))}}catch(P){console.error("Failed to load more messages",P)}finally{B(P=>({...P,[t]:!1}))}},Ie=t?Q[t]??[]:[],Pe=E.find(v=>v.id===t),Re=Pe?.name??"",Ae=Pe?.avatar,Te=U.find(v=>v.id.toString()===t),Oe=Te?.member_count,ze=Te?.online_count,Ee=t&&M[t]||!1,Fe=v=>{t&&N(C=>({...C,[t]:[...C[t]??[],v.attachment?"file"in v.attachment?{id:Math.random().toString(36).slice(2),sender:"me",at:Date.now(),file:{type:v.attachment.type,url:URL.createObjectURL(v.attachment.file),name:v.attachment.file.name}}:{id:Math.random().toString(36).slice(2),sender:"me",at:Date.now(),file:{type:"location",url:v.attachment.url,name:v.attachment.name}}:{id:Math.random().toString(36).slice(2),sender:"me",text:v.text??"",at:Date.now()}]}))},Rt=v=>{const C=new Set(a?.blocklist??[]),P=E.filter(F=>F.type==="private"&&!C.has(F.name));N(F=>{const x={...F};return P.forEach(k=>{const ae=x[k.id]??[];ae.push({id:Math.random().toString(36).slice(2),sender:"me",text:v,at:Date.now()}),x[k.id]=ae}),x})},qe=({name:v,type:C})=>{const P=E.find(k=>k.name===v&&k.type===C);if(P){Z(P.id);return}const F=Math.random().toString(36).slice(2),x={id:F,name:v,type:C,avatar:"/placeholder.svg"};C==="private"?R(k=>[...k,x]):A(k=>[...k,x]),N(k=>({...k,[F]:[]})),Z(F)};return e.jsxs("div",{className:"py-6 px-6",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[e.jsxs(Ne,{children:[e.jsx(Ce,{asChild:!0,children:e.jsxs("button",{className:"inline-flex items-center gap-2 text-sm text-left hover:opacity-90",children:[f?.profile_picture?e.jsx("img",{src:f.profile_picture,alt:f.name,className:"h-8 w-8 rounded-full object-cover"}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary text-white grid place-items-center font-semibold text-xs",children:f?.name.split(" ").map(v=>v[0]).slice(0,2).join("")}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"font-medium",children:f?.name||" hisob tanlanmagan "}),f?.phone&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",f.phone.slice(0,3)," ",f.phone.slice(3,5)," ",f.phone.slice(5,8)," ",f.phone.slice(8,10)," ",f.phone.slice(10)]})]}),e.jsx(De,{className:"h-3 w-3"})]})}),e.jsxs(Se,{align:"start",children:[a?.telegramAccounts.map(v=>e.jsxs(H,{onClick:()=>i(v.id),className:`flex items-center gap-2 ${v.id===a.activeTelegramAccountId?"bg-accent":""}`,children:[v.profile_picture?e.jsx("img",{src:v.profile_picture,alt:v.name,className:"h-8 w-8 rounded-full object-cover"}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary text-white grid place-items-center font-semibold text-xs",children:v.name.split(" ").map(C=>C[0]).slice(0,2).join("")}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"font-medium",children:v.name}),v.phone&&e.jsxs("div",{className:"text-xs",children:["+",v.phone.slice(0,3)," ",v.phone.slice(3,5)," ",v.phone.slice(5,8)," ",v.phone.slice(8,10)," ",v.phone.slice(10)]})]})]},v.id)),e.jsx(ke,{}),e.jsx(H,{onClick:()=>w(!0),children:"Hisob boshqarish"})]})]}),e.jsx(O,{size:"sm",className:"text-white",onClick:()=>m(!0),children:"Hisob qo'shish"}),e.jsx(O,{size:"sm",variant:"secondary",onClick:()=>l(!0),children:"Mass xabar"}),e.jsx(O,{size:"sm",variant:"ghost",onClick:()=>j(!0),children:"Shablonlar"}),e.jsx(O,{size:"sm",variant:"ghost",onClick:()=>d(!0),children:"Sozlamalar"})]}),e.jsxs("div",{className:"md:hidden flex items-center gap-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:f?f.name:"Hisob yo'q"}),e.jsx(pn,{onAdd:()=>{},onMass:()=>l(!0),onTemplates:()=>j(!0),onSettings:()=>d(!0),onAccounts:()=>w(!0)})]}),e.jsx("div",{className:"text-xs text-muted-foreground hidden sm:block",children:"Offline rejim qo'llab-quvvatlanadi"})]}),n?e.jsx("div",{className:"rounded-xl border overflow-hidden h-[70vh] flex flex-col",children:t?e.jsxs("div",{className:"flex flex-col h-[70vh] min-h-0",children:[e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Ke,{title:Re,status:"online",messages:Ie,onBack:()=>Z(null),avatar:Ae,memberCount:Oe,onlineCount:ze,onLoadMore:Me,isLoadingMore:Ee,loadingMessages:D},t)}),e.jsx(Ve,{onSend:Fe})]}):e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Ue,{chats:E,currentId:null,onSelect:Z,onCreateChat:qe,user:a,loadingPrivate:K,loadingGroups:J,emptyMessage:"Chatlar yo'q",tab:h,onTabChange:_})})}):e.jsxs("div",{className:"flex gap-3 rounded-xl border overflow-hidden h-[70vh]",children:[e.jsx(Ue,{chats:E,currentId:t,onSelect:Z,onCreateChat:qe,user:a,collapsed:b,onToggleCollapsed:()=>I(v=>!v),loadingPrivate:K,loadingGroups:J,emptyMessage:"Chatlar yo'q",tab:h,onTabChange:_}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Ke,{title:Re,status:"online",messages:Ie,collapsed:b,avatar:Ae,memberCount:Oe,onlineCount:ze,onLoadMore:Me,isLoadingMore:Ee,loadingMessages:D},t)}),e.jsx(Ve,{onSend:Fe})]})]}),e.jsx(dn,{open:r,onClose:()=>m(!1),onSuccess:v=>{console.log("Account added successfully:",v)}}),e.jsx(Wa,{open:o,onClose:()=>l(!1),onSend:Rt}),e.jsx(mn,{open:u,onClose:()=>w(!1)}),e.jsx(hn,{open:y,onClose:()=>j(!1)}),e.jsx(xn,{open:c,onClose:()=>d(!1)})]})}function pn({onAdd:a,onMass:i,onTemplates:n,onSettings:o,onAccounts:l}){return e.jsxs(Ne,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx("button",{className:"rounded-md border px-2 py-2 hover:bg-accent/40","aria-label":"Amallar",title:"Amallar",children:e.jsx(ja,{className:"h-4 w-4"})})}),e.jsxs(Se,{align:"end",children:[e.jsx(H,{onClick:l,children:"Hozirgi hisob"}),e.jsx(H,{onClick:a,children:"Hisob qo'shish"}),e.jsx(H,{onClick:i,children:"Mass xabar"}),e.jsx(H,{onClick:n,children:"Shablonlar"}),e.jsx(H,{onClick:o,children:"Sozlamalar"})]})]})}export{Cn as default};
