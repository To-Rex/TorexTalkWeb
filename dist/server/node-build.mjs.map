{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/routes/private-chats.ts","../../server/routes/groups.ts","../../server/routes/chat-messages.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\r\nimport { DemoResponse } from \"@shared/api\";\r\n\r\nexport const handleDemo: RequestHandler = (req, res) => {\r\n  const response: DemoResponse = {\r\n    message: \"Hello from Express server\",\r\n  };\r\n  res.status(200).json(response);\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport { PrivateChatsResponse } from \"@shared/api\";\r\n\r\nexport const handlePrivateChats: RequestHandler = (req, res) => {\r\n  const { session_index } = req.params;\r\n  // Mock response for now\r\n  const response: PrivateChatsResponse = {\r\n    ok: true,\r\n    count: 3,\r\n    items: [\r\n      {\r\n        id: 777000,\r\n        full_name: \"Telegram\",\r\n        username: null,\r\n        last_seen: \"online\",\r\n        is_online: true,\r\n        has_photo: true,\r\n        photo_url: \"/media/avatars/default.jpg\"\r\n      },\r\n      {\r\n        id: 152856580,\r\n        full_name: \"Zokir Aka\",\r\n        username: \"Zokriy\",\r\n        last_seen: \"recently\",\r\n        is_online: false,\r\n        has_photo: false,\r\n        photo_url: \"/media/avatars/default.jpg\"\r\n      },\r\n      {\r\n        id: 7488382262,\r\n        full_name: \"Bobokulov\",\r\n        username: \"bobokulov010\",\r\n        last_seen: \"offline\",\r\n        is_online: false,\r\n        has_photo: false,\r\n        photo_url: \"/media/avatars/default.jpg\"\r\n      }\r\n    ]\r\n  };\r\n  res.json(response);\r\n};","import { RequestHandler } from \"express\";\r\nimport { GroupsResponse } from \"@shared/api\";\r\n\r\nexport const handleGroups: RequestHandler = (req, res) => {\r\n  const { session_index } = req.params;\r\n  // Mock response for now\r\n  const response: GroupsResponse = {\r\n    ok: true,\r\n    count: 3,\r\n    items: [\r\n      {\r\n        id: -1003453950518,\r\n        title: \"â¤ï¸ðŸŽ‚Shirinliklar olamiâ¤ï¸ðŸŽ‚\",\r\n        username: \"Shaxnoz_bakeryyy\",\r\n        member_count: 1815,\r\n        online_count: 1,\r\n        has_photo: true,\r\n        photo_url: \"/media/avatars/71f286af-80cf-4d7e-8e2b-b3ec62b12709/1/-1003453950518.jpg\"\r\n      },\r\n      {\r\n        id: -1001522987908,\r\n        title: \"Arzon bumagalar\",\r\n        username: null,\r\n        member_count: 500,\r\n        online_count: 5,\r\n        has_photo: false,\r\n        photo_url: \"/media/avatars/default.jpg\"\r\n      },\r\n      {\r\n        id: -1002740169594,\r\n        title: \"DoubleH Programming team\",\r\n        username: null,\r\n        member_count: 25,\r\n        online_count: 3,\r\n        has_photo: true,\r\n        photo_url: \"/media/avatars/default.jpg\"\r\n      }\r\n    ]\r\n  };\r\n  res.json(response);\r\n};","import { RequestHandler } from \"express\";\r\nimport { ChatMessagesResponse, MessageItem } from \"@shared/api\";\r\n\r\nexport const handleChatMessages: RequestHandler = (req, res) => {\r\n  const { chat_id } = req.params;\r\n  const { session_index, limit = 10, offset = 0 } = req.query;\r\n\r\n  const parsedLimit = parseInt(limit as string, 10);\r\n  const parsedOffset = parseInt(offset as string, 10);\r\n\r\n  // Generate mock messages based on offset\r\n  const generateMockMessages = (startId: number, count: number): MessageItem[] => {\r\n    const messages: MessageItem[] = [];\r\n    for (let i = 0; i < count; i++) {\r\n      const id = startId - i;\r\n      const isOutgoing = i % 2 === 0; // Alternate for demo\r\n      messages.push({\r\n        id,\r\n        date: new Date(Date.now() - (count - i) * 60000).toISOString(), // Decreasing time\r\n        chat_id: parseInt(chat_id),\r\n        chat_type: parseInt(chat_id) > 0 ? \"private\" : \"supergroup\",\r\n        from_user: isOutgoing ? {\r\n          id: 777000,\r\n          first_name: \"Telegram\",\r\n          last_name: null,\r\n          username: null,\r\n          phone_number: null,\r\n          photo_url: null,\r\n          status: null,\r\n          bio: null\r\n        } : {\r\n          id: 6208845490,\r\n          first_name: \"Shahnozabonu\",\r\n          last_name: null,\r\n          username: null,\r\n          phone_number: null,\r\n          photo_url: \"/media/avatars/71f286af-80cf-4d7e-8e2b-b3ec62b12709/1/6208845490.jpg\",\r\n          status: \"UserStatus.RECENTLY\",\r\n          bio: null\r\n        },\r\n        text: `Message ${id}`,\r\n        caption: null,\r\n        media_type: null,\r\n        file_id: null,\r\n        file_name: null,\r\n        mime_type: null,\r\n        is_read: !isOutgoing,\r\n        is_outgoing: parseInt(chat_id) > 0 ? isOutgoing : null\r\n      });\r\n    }\r\n    return messages.reverse(); // Latest first\r\n  };\r\n\r\n  const totalMessages = 50; // Total messages in chat\r\n  const startId = 5621 - parsedOffset; // Start from latest\r\n  const available = Math.max(0, totalMessages - parsedOffset);\r\n  const messages = generateMockMessages(startId, Math.min(parsedLimit, available));\r\n\r\n  const response: ChatMessagesResponse = {\r\n    ok: true,\r\n    count: totalMessages,\r\n    messages\r\n  };\r\n\r\n  res.json(response);\r\n};","import \"dotenv/config\";\r\nimport express from \"express\";\r\nimport cors from \"cors\";\r\nimport compression from \"compression\";\r\nimport { handleDemo } from \"./routes/demo\";\r\nimport { handlePrivateChats } from \"./routes/private-chats\";\r\nimport { handleGroups } from \"./routes/groups\";\r\nimport { handleChatMessages } from \"./routes/chat-messages\";\r\n\r\nexport function createServer() {\r\n  const app = express();\r\n\r\n  // Middleware\r\n  app.use(compression());\r\n  app.use(cors());\r\n  app.use(express.json());\r\n  app.use(express.urlencoded({ extended: true }));\r\n\r\n  // Example API routes\r\n  app.get(\"/api/ping\", (_req, res) => {\r\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\r\n    res.json({ message: ping });\r\n  });\r\n\r\n  app.get(\"/api/demo\", handleDemo);\r\n  app.get(\"/api/me/private_chats/:session_index\", handlePrivateChats);\r\n  app.get(\"/api/me/groups/:session_index\", handleGroups);\r\n  app.get(\"/api/me/chats/:chat_id/messages\", handleChatMessages);\r\n\r\n  return app;\r\n}\r\n","import path from \"path\";\r\nimport { createServer } from \"./index\";\r\nimport * as express from \"express\";\r\n\r\nconst app = createServer();\r\nconst port = process.env.PORT || 3000;\r\n\r\n// In production, serve the built SPA files\r\nconst __dirname = import.meta.dirname;\r\nconst distPath = path.join(__dirname, \"../spa\");\r\n\r\n// Serve static files\r\napp.use(express.static(distPath));\r\n\r\n// Handle React Router - serve index.html for all non-API routes\r\napp.get(\"*\", (req, res) => {\r\n  // Don't serve index.html for API routes\r\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\r\n    return res.status(404).json({ error: \"API endpoint not found\" });\r\n  }\r\n\r\n  res.sendFile(path.join(distPath, \"index.html\"));\r\n});\r\n\r\napp.listen(port, () => {\r\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\r\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\r\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\r\n});\r\n\r\n// Graceful shutdown\r\nprocess.on(\"SIGTERM\", () => {\r\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\r\n  process.exit(0);\r\n});\r\n\r\nprocess.on(\"SIGINT\", () => {\r\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\r\n  process.exit(0);\r\n});\r\n"],"names":["startId","messages","app","express"],"mappings":"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"}